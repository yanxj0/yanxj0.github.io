const sn="1.0.0-rc.4",ut=typeof window<"u",qt=typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:Function("return this")(),an=()=>!1,k=Array.isArray,X=Object.assign,F=Object.defineProperty,oe=Object.defineProperties,cn=Object.prototype.toString,ue=Object.prototype.hasOwnProperty,re=t=>cn.call(t);function de(t){return t===void 0}function rt(t){return t===null}function L(t){return typeof t=="string"}function Qt(t){return typeof t=="boolean"}function nt(t){return typeof t=="number"}function y(t){return typeof t=="function"}function T(t){return re(t)==="[object Object]"}function Vt(t){return!rt(t)&&typeof t=="object"}function ot(t){return re(t)==="[object Promise]"}function ln(t){return y(t)&&t.name.indexOf("bound ")===0&&!t.hasOwnProperty("prototype")}function ht(t){var e;if(y(t)){const r=t.toString();return((e=t.prototype)===null||e===void 0?void 0:e.constructor)===t&&Object.getOwnPropertyNames(t.prototype).length>1||/^function\s+[A-Z]/.test(r)||/^class\s+/.test(r)}return!1}function un(t){return typeof ShadowRoot<"u"&&t instanceof ShadowRoot}function Be(t){var e;return t instanceof URL||!!(!((e=t)===null||e===void 0)&&e.href)}function se(t){var e;return t instanceof Element||L((e=t)===null||e===void 0?void 0:e.tagName)}function Ae(t){var e;return t instanceof Node||nt((e=t)===null||e===void 0?void 0:e.nodeType)}function Xt(t){return re(t)==="[object HTMLLinkElement]"}function dt(t){return re(t)==="[object HTMLStyleElement]"}function Ee(t){return re(t)==="[object HTMLScriptElement]"}function hn(t){return re(t)==="[object HTMLDivElement]"}function dn(t){return re(t)==="[object HTMLImageElement]"}function fn(t){return re(t)==="[object HTMLBaseElement]"}function it(t){return se(t)&&t.tagName.toUpperCase()==="MICRO-APP-BODY"}function pn(t){return re(t)==="[object ProxyDocument]"}function V(t,e,r){if(t==null)throw new TypeError("includes target is null or undefined");const n=Object(t),o=parseInt(n.length,10)||0;if(o===0)return!1;r=parseInt(r,10)||0;let i=Math.max(r>=0?r:o+r,0);for(;i<o;){if(e===n[i]||e!==e&&n[i]!==n[i])return!0;i++}return!1}function D(t,e=null,...r){const n=e&&L(e)?` app ${e}:`:"";L(t)}function le(t,e=null,...r){const n=e&&L(e)?` app ${e}:`:"";L(t)}function J(t,...e){Promise.resolve().then(t.bind(null,...e))}const x=function(){class t extends URL{}return(e,r)=>r?new t(""+e,r):new t(""+e)}();function ft(t){return t.startsWith("//")?`${qt.location.protocol}${t}`:t}function st(t,e=null){if(!L(t)||!t)return"";try{const{origin:r,pathname:n,search:o}=x(ft(t),(window.rawWindow||window).location.href);if(/\.(\w+)$/.test(n))return`${r}${n}${o}`;const i=`${r}${n}/`.replace(/\/\/$/,"/");return/^https?:\/\//.test(i)?`${i}${o}`:""}catch(r){return D(r,e),""}}function W(t){return!L(t)||!t?"":t.replace(/(^\d+)|([^\w\d-_])/gi,"")}function Xe(t){const{origin:e,pathname:r}=x(t);if(/\.(\w+)$/.test(r)){const o=`${e}${r}`.split("/");return o.pop(),o.join("/")+"/"}return`${e}${r}/`.replace(/\/\/$/,"/")}function G(t,e){return!t||/^((((ht|f)tps?)|file):)?\/\//.test(t)||/^(data|blob):/.test(t)?t:x(t,Xe(ft(e))).toString()}function mn(t){const e=t.split("/");return e.pop(),ft(e.join("/")+"/")}function ze(t,e,r,n){let o=0;function i(){++o===t.length&&n&&n()}t.forEach((s,a)=>{ot(s)?s.then(c=>{e({data:c,index:a}),i()}).catch(c=>{r({error:c,index:a}),i()}):(e({data:s,index:a}),i())})}function _n(){return"noModule"in document.createElement("script")}function En(){return"inline-"+Math.random().toString(36).substr(2,15)}function gn(t){return t.filter(function(e){return e in this?!1:this[e]=!0},Object.create(null))}const Ye=qt.requestIdleCallback||function(t){const e=Date.now();return setTimeout(function(){t({didTimeout:!1,timeRemaining(){return Math.max(0,50-(Date.now()-e))}})},1)};function zt(t){return new Promise(e=>{Ye(()=>{t(e)})})}let pt=null;function at(t){pt=t}function j(){return pt}let je=!1;function U(t){at(null),t&&!je&&(je=!0,J(()=>{je=!1}))}function fe(t){pt!==t&&!je&&(at(t),J(()=>{at(null)}))}function K(t,e){const r=(window.rawDocument||document).createElement(t,e);return r.__MICRO_APP_NAME__&&delete r.__MICRO_APP_NAME__,r.__PURE_ELEMENT__=!0,r}function ie(t){return!t||/(^\d)|([^\w\d-_\u4e00-\u9fa5])/gi.test(t)}function ge(t){return/^body$/i.test(t)||/^head$/i.test(t)||/^html$/i.test(t)||/^title$/i.test(t)||/^:root$/i.test(t)}function te(t){return un(t)?t.host:t}function et(t){return t?t.replace(/^\s+|\s+$/g,""):""}function Dt(){return navigator.userAgent.indexOf("Firefox")>-1}function Ot(t){const e={},r=t.split("&");for(const n of r){const o=n.indexOf("="),i=o<0?n:n.slice(0,o),s=o<0?null:n.slice(o+1);if(i in e){let a=e[i];k(a)||(a=e[i]=[a]),a.push(s)}else e[i]=s}return e}function Ge(t){let e="";for(const r in t){const n=t[r];rt(n)?e+=(e.length?"&":"")+r:(k(n)?n:[n]).forEach(i=>{de(i)||(e+=(e.length?"&":"")+r,rt(i)||(e+="="+i))})}return e}function Ct(){const t=new Set;function e(r){return t.add(r),()=>t.has(r)?t.delete(r):!1}return{add:e,list:()=>t}}function wn(){const t=new Map;function e(r,n){return t.set(r,n),()=>t.has(r)?t.delete(r):!1}return{add:e,get:r=>t.get(r),delete:r=>t.has(r)?t.delete(r):!1}}function ct(t){const e=t.attributes,r=new Map;for(let n=0;n<e.length;n++)r.set(e[n].name,e[n].value);return r}function Oe(t,e){t?t.push(()=>zt(r=>{e(),r()})):e()}function Ce(t){return(t==null?void 0:t.reduce((e,r)=>e.then(r),Promise.resolve()))||null}function Ie(t){return t.startsWith("inline-")}function It(t,e,r,...n){try{y(t)&&t(...n)}catch(o){D(`An error occurred in app ${e} window.${r} 
`,null,o)}}function An(t){for(;t!=null&&t.firstChild;)t.removeChild(t.firstChild)}function vn(){var t;return((t=window.rawWindow)===null||t===void 0?void 0:t.HTMLElement)||window.HTMLElement}function bn(t,e){Object.defineProperties(t,{currentTarget:{get(){return e}},target:{get(){return e}}})}function ne(t,e,r,n){var o;if(!t)return D(`element does not exist in lifecycle ${r}`,e);t=te(t),U();const i=X({name:e,container:t},n&&{error:n}),s=new CustomEvent(r,{detail:i});bn(s,t),y((o=R.options.lifeCycles)===null||o===void 0?void 0:o[r])&&R.options.lifeCycles[r](s),t.dispatchEvent(s)}function Z(t,e,r={}){var n;const o=new CustomEvent(e,{detail:r});(n=t.sandBox)===null||n===void 0||n.microAppWindow.dispatchEvent(o)}function pe(t,e=null,r={}){return U(),y(R.options.fetch)?R.options.fetch(t,r,e):window.fetch(t,r).then(n=>n.text())}class mt{static getInstance(){return this.instance||(this.instance=new mt),this.instance}run(e,r){const n=e.name,o=e.ssrUrl||e.url;(o.includes(".js")?Promise.resolve(`<micro-app-head><script src='${o}'><\/script></micro-app-head><micro-app-body></micro-app-body>`):pe(o,n,{cache:"no-cache"})).then(s=>{if(!s){const a="html is empty, please check in detail";return e.onerror(new Error(a)),D(a,n)}s=this.formatHTML(o,s,n),r(s,e)}).catch(s=>{D(`Failed to fetch data from ${e.url}, micro-app stop rendering`,n,s),e.onLoadError(s)})}formatHTML(e,r,n){return this.processHtml(e,r,n,R.options.plugins).replace(/<head[^>]*>[\s\S]*?<\/head>/i,o=>o.replace(/<head/i,"<micro-app-head").replace(/<\/head>/i,"</micro-app-head>")).replace(/<body[^>]*>[\s\S]*?<\/body>/i,o=>o.replace(/<body/i,"<micro-app-body").replace(/<\/body>/i,"</micro-app-body>"))}processHtml(e,r,n,o){var i;if(!o)return r;const s=[];return o.global&&s.push(...o.global),!((i=o.modules)===null||i===void 0)&&i[n]&&s.push(...o.modules[n]),s.length>0?s.reduce((a,c)=>T(c)&&y(c.processHtml)?c.processHtml(a,e):a,r):r}}const Pn=/(^|\s+)(html|:root)(?=[\s>~[.#:]+|$)/,Lt=/(^|\s+)((html[\s>~]+body)|body)(?=[\s>~[.#:]+|$)/;function Y(t,e){t=e?`${e} ${t}`:t;const r=new Error(t);throw r.reason=t,e&&(r.filename=e),r}class Rn{constructor(){this.cssText="",this.prefix="",this.baseURI="",this.linkPath="",this.result="",this.scopecssDisable=!1,this.scopecssDisableSelectors=[],this.scopecssDisableNextLine=!1,this.mediaRule=this.createMatcherForRuleWithChildRule(/^@media *([^{]+)/,"@media"),this.supportsRule=this.createMatcherForRuleWithChildRule(/^@supports *([^{]+)/,"@supports"),this.documentRule=this.createMatcherForRuleWithChildRule(/^@([-\w]+)?document *([^{]+)/,"@document"),this.hostRule=this.createMatcherForRuleWithChildRule(/^@host\s*/,"@host"),this.importRule=this.createMatcherForNoneBraceAtRule("import"),this.charsetRule=this.createMatcherForNoneBraceAtRule("charset"),this.namespaceRule=this.createMatcherForNoneBraceAtRule("namespace"),this.containerRule=this.createMatcherForRuleWithChildRule(/^@container *([^{]+)/,"@container")}exec(e,r,n,o){return this.cssText=e,this.prefix=r,this.baseURI=n,this.linkPath=o||"",this.matchRules(),Dt()?decodeURIComponent(this.result):this.result}reset(){this.cssText=this.prefix=this.baseURI=this.linkPath=this.result="",this.scopecssDisable=this.scopecssDisableNextLine=!1,this.scopecssDisableSelectors=[]}matchRules(){for(this.matchLeadingSpaces(),this.matchComments();this.cssText.length&&this.cssText.charAt(0)!=="}"&&(this.matchAtRule()||this.matchStyleRule());)this.matchComments()}matchStyleRule(){const e=this.formatSelector(!0);return this.scopecssDisableNextLine=!1,e?(this.recordResult(e),this.matchComments(),this.styleDeclarations(),this.matchLeadingSpaces(),!0):Y("selector missing",this.linkPath)}formatSelector(e){const r=this.commonMatch(/^[^{]+/,e);return r?r[0].replace(/(^|,[\n\s]*)([^,]+)/g,(n,o,i)=>(i=et(i),this.scopecssDisableNextLine||this.scopecssDisable&&(!this.scopecssDisableSelectors.length||this.scopecssDisableSelectors.includes(i))||Pn.test(i)||(Lt.test(i)?i=i.replace(Lt,this.prefix+" micro-app-body"):i=this.prefix+" "+i),o+i)):!1}styleDeclarations(){return this.matchOpenBrace()?(this.matchAllDeclarations(),this.matchCloseBrace()?!0:Y("Declaration missing '}'",this.linkPath)):Y("Declaration missing '{'",this.linkPath)}matchAllDeclarations(e=1){let r=this.commonMatch(/^(?:url\(["']?(?:[^)"'}]+)["']?\)|[^{}/])*/,!0)[0];if(r&&(!this.scopecssDisableNextLine&&(!this.scopecssDisable||this.scopecssDisableSelectors.length)&&(r=r.replace(/url\(["']?([^)"']+)["']?\)/gm,(n,o)=>/^((data|blob):|#)/.test(o)||/^(https?:)?\/\//.test(o)?n:(/^((\.\.?\/)|[^/])/.test(o)&&this.linkPath&&(this.baseURI=mn(this.linkPath)),`url("${G(o,this.baseURI)}")`))),this.recordResult(r)),this.scopecssDisableNextLine=!1,!!this.cssText)return this.cssText.charAt(0)==="}"?e?(e>1&&this.commonMatch(/}+/),this.matchAllDeclarations(e-1)):void 0:(this.cssText.charAt(0)==="/"&&(this.cssText.charAt(1)==="*"?this.matchComments():this.commonMatch(/\/+/)),this.cssText.charAt(0)==="{"&&(this.commonMatch(/{+\s*/),e++),this.matchAllDeclarations(e))}matchAtRule(){return this.cssText[0]!=="@"?!1:(this.scopecssDisableNextLine=!1,this.keyframesRule()||this.mediaRule()||this.customMediaRule()||this.supportsRule()||this.importRule()||this.charsetRule()||this.namespaceRule()||this.containerRule()||this.documentRule()||this.pageRule()||this.hostRule()||this.fontFaceRule())}keyframesRule(){if(!this.commonMatch(/^@([-\w]+)?keyframes\s*/))return!1;if(!this.commonMatch(/^[^{]+/))return Y("@keyframes missing name",this.linkPath);if(this.matchComments(),!this.matchOpenBrace())return Y("@keyframes missing '{'",this.linkPath);for(this.matchComments();this.keyframeRule();)this.matchComments();return this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):Y("@keyframes missing '}'",this.linkPath)}keyframeRule(){let e;const r=[];for(;e=this.commonMatch(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)r.push(e[1]),this.commonMatch(/^,\s*/);return r.length?(this.styleDeclarations(),this.matchLeadingSpaces(),!0):!1}customMediaRule(){return this.commonMatch(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/)?(this.matchLeadingSpaces(),!0):!1}pageRule(){return this.commonMatch(/^@page */)?(this.formatSelector(!1),this.scopecssDisableNextLine=!1,this.commonHandlerForAtRuleWithSelfRule("page")):!1}fontFaceRule(){return this.commonMatch(/^@font-face\s*/)?this.commonHandlerForAtRuleWithSelfRule("font-face"):!1}createMatcherForRuleWithChildRule(e,r){return()=>this.commonMatch(e)?this.matchOpenBrace()?(this.matchComments(),this.matchRules(),this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):Y(`${r} missing '}'`,this.linkPath)):Y(`${r} missing '{'`,this.linkPath):!1}createMatcherForNoneBraceAtRule(e){const r=new RegExp("^@"+e+"\\s*([^;]+);");return()=>this.commonMatch(r)?(this.matchLeadingSpaces(),!0):!1}commonHandlerForAtRuleWithSelfRule(e){return this.matchOpenBrace()?(this.matchAllDeclarations(),this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):Y(`@${e} missing '}'`,this.linkPath)):Y(`@${e} missing '{'`,this.linkPath)}matchComments(){for(;this.matchComment(););}matchComment(){if(this.cssText.charAt(0)!=="/"||this.cssText.charAt(1)!=="*")return!1;this.scopecssDisableNextLine=!1;let e=2;for(;this.cssText.charAt(e)!==""&&(this.cssText.charAt(e)!=="*"||this.cssText.charAt(e+1)!=="/");)++e;if(e+=2,this.cssText.charAt(e-1)==="")return Y("End of comment missing",this.linkPath);let r=this.cssText.slice(2,e-2);return this.recordResult(`/*${r}*/`),r=et(r.replace(/^\s*!/,"")),r==="scopecss-disable-next-line"?this.scopecssDisableNextLine=!0:/^scopecss-disable/.test(r)?r==="scopecss-disable"?this.scopecssDisable=!0:(this.scopecssDisable=!0,r.replace("scopecss-disable","").split(",").forEach(o=>{this.scopecssDisableSelectors.push(et(o))})):r==="scopecss-enable"&&(this.scopecssDisable=!1,this.scopecssDisableSelectors=[]),this.cssText=this.cssText.slice(e),this.matchLeadingSpaces(),!0}commonMatch(e,r=!1){const n=e.exec(this.cssText);if(!n)return;const o=n[0];return this.cssText=this.cssText.slice(o.length),r||this.recordResult(o),n}matchOpenBrace(){return this.commonMatch(/^{\s*/)}matchCloseBrace(){return this.commonMatch(/^}/)}matchLeadingSpaces(){this.commonMatch(/^\s*/)}recordResult(e){Dt()?this.result+=encodeURIComponent(e):this.result+=e}}function Nt(t,e,r,n,o){if(!t.__MICRO_APP_HAS_SCOPED__){t.__MICRO_APP_HAS_SCOPED__=!0;let i=null;try{i=Se.exec(t.textContent,r,n,o),Se.reset()}catch(s){Se.reset(),D(`An error occurred while parsing CSS:
`,e,s)}i&&(t.textContent=i)}}let Se;function _t(t,e,r){if(e.scopecss){const n=Et(e.name);if(Se||(Se=new Rn),t.textContent)Nt(t,e.name,n,e.url,r);else{const o=new MutationObserver(function(){o.disconnect(),t.textContent&&!t.hasAttribute("data-styled")&&Nt(t,e.name,n,e.url,r)});o.observe(t,{childList:!0})}}return t}function Et(t,e=!1){const r=e?"\\":"";return`${R.tagName}${r}[name=${t}${r}]`}function Yt(t,e){Object.defineProperties(t,{currentTarget:{get(){return e}},srcElement:{get(){return e}},target:{get(){return e}}})}function Jt(t){const e=new CustomEvent("load");Yt(e,t),y(t.onload)?t.onload(e):t.dispatchEvent(e)}function Zt(t){const e=new CustomEvent("error");Yt(e,t),y(t.onerror)?t.onerror(e):t.dispatchEvent(e)}function Sn(){const t=new Map,e=new Map;function r(n){return{setInfo(o,i){n.set(o,i)},getInfo(o){var i;return(i=n.get(o))!==null&&i!==void 0?i:null},hasInfo(o){return n.has(o)},deleteInfo(o){return n.delete(o)}}}return{link:r(t),script:Object.assign(Object.assign({},r(e)),{deleteInlineInfo(n){n.forEach(o=>{Ie(o)&&e.delete(o)})}})}}var q=Sn();function yn(t,e,r){const n=r.appSpace;for(const o in n)if(o!==t){const i=n[o];if(i.parsedCode)return i.parsedCode.replace(new RegExp(Et(o,!0),"g"),e)}}function Mn(t,e){e.forEach((r,n)=>{n!=="rel"&&(n==="href"&&(n="data-origin-href"),l.rawSetAttribute.call(t,n,r))})}function kt(t,e,r,n=!1){const o=t.getAttribute("rel");let i=t.getAttribute("href"),s=null;if(o==="stylesheet"&&i){i=G(i,r.url);let a=q.link.getInfo(i);const c={attrs:ct(t)};if(a?a.appSpace[r.name]=a.appSpace[r.name]||c:a={code:"",appSpace:{[r.name]:c}},q.link.setInfo(i,a),!n)r.source.links.add(i),s=document.createComment(`link element with href=${i} move to micro-app-head as style element`),a.appSpace[r.name].placeholder=s;else return{address:i,linkInfo:a}}else o&&["prefetch","preload","prerender"].includes(o)?n?s=document.createComment(`link element with rel=${o}${i?" & href="+i:""} removed by micro-app`):e==null||e.removeChild(t):i&&l.rawSetAttribute.call(t,"href",G(i,r.url));if(n)return{replaceComment:s};if(s)return e==null?void 0:e.replaceChild(s,t)}function Dn(t,e,r,n){const o=Array.from(e.source.links),i=o.map(a=>{const c=q.link.getInfo(a);return c.code?c.code:pe(a,e.name)}),s=n?[]:null;ze(i,a=>{Oe(s,()=>On(o[a.index],a.data,r,e))},a=>{D(a,e.name)},()=>{n?n.then(()=>{s.push(()=>Promise.resolve(e.onLoad({html:t}))),Ce(s)}):e.onLoad({html:t})})}function On(t,e,r,n){const o=q.link.getInfo(t);o.code=e;const i=o.appSpace[n.name],s=i.placeholder;if(s){const a=K("style");er(n,t,a,o,i.attrs),s.parentNode?s.parentNode.replaceChild(a,s):r.appendChild(a),i.placeholder=null}}function er(t,e,r,n,o){if(t.scopecss){const i=n.appSpace[t.name];if(i.prefix=i.prefix||Et(t.name),i.parsedCode)r.textContent=i.parsedCode;else{const s=yn(t.name,i.prefix,n);s?r.textContent=s:(r.textContent=n.code,_t(r,t,e)),i.parsedCode=r.textContent}}else r.textContent=n.code;Mn(r,o)}function Cn(t,e,r,n){const o=K("style"),i=()=>{er(e,t,o,r,r.appSpace[e.name].attrs),Jt(n)};return r.code?J(i):pe(t,e.name).then(s=>{r.code=s,i()}).catch(s=>{D(s,e.name),Zt(n)}),o}var ye;(function(t){t.NAME="name",t.URL="url"})(ye||(ye={}));var B;(function(t){t.CREATED="created",t.LOADING="loading",t.LOAD_FAILED="load_failed",t.BEFORE_MOUNT="before_mount",t.MOUNTING="mounting",t.MOUNTED="mounted",t.UNMOUNT="unmount"})(B||(B={}));var C;(function(t){t.CREATED="created",t.BEFOREMOUNT="beforemount",t.MOUNTED="mounted",t.UNMOUNT="unmount",t.ERROR="error",t.BEFORESHOW="beforeshow",t.AFTERSHOW="aftershow",t.AFTERHIDDEN="afterhidden"})(C||(C={}));var me;(function(t){t.ONMOUNT="onmount",t.ONUNMOUNT="onunmount"})(me||(me={}));var Me;(function(t){t.KEEP_ALIVE_SHOW="keep_alive_show",t.KEEP_ALIVE_HIDDEN="keep_alive_hidden"})(Me||(Me={}));var xt;(function(t){t.DESTROY="destroy",t.DESTORY="destory",t.INLINE="inline",t.DISABLESCOPECSS="disableScopecss",t.DISABLESANDBOX="disableSandbox",t.DISABLE_SCOPECSS="disable-scopecss",t.DISABLE_SANDBOX="disable-sandbox",t.DISABLE_MEMORY_ROUTER="disable-memory-router",t.DISABLE_PATCH_REQUEST="disable-patch-request",t.KEEP_ROUTER_STATE="keep-router-state",t.HIDDEN_ROUTER="hidden-router",t.KEEP_ALIVE="keep-alive",t.CLEAR_DATA="clear-data",t.SSR="ssr",t.FIBER="fiber"})(xt||(xt={}));const Tt=[1,2,3],Le="search",Ke="native",tr="native-scope",rr="pure",In=[Le,Ke,tr,rr],nr=["popstate","hashchange","load","beforeunload","unload","unmount","appstate-change","statechange","mounted"],or=["onpopstate","onhashchange","onload","onbeforeunload","onunload","onerror"],Ln=["DOMContentLoaded","readystatechange"],Nn=["onreadystatechange"],ir=["window","self","globalThis"],xn=["rawWindow","rawDocument"],Ut="window,self,globalThis,document,Document,Array,Object,String,Boolean,Math,Number,Symbol,Date,Function,Proxy,WeakMap,WeakSet,Set,Map,Reflect,Element,Node,RegExp,Error,TypeError,JSON,isNaN,parseFloat,parseInt,performance,console,decodeURI,encodeURI,decodeURIComponent,encodeURIComponent,navigator,undefined,location,history",Tn=["text/javascript","text/ecmascript","application/javascript","application/ecmascript","module","systemjs-module","systemjs-importmap"];function ae(t,e){return e.appSpace[t.name].module&&(!t.useSandbox||t.iframe)}function Un(t,e){return e.appSpace[t.name].attrs.has("id")}function Je(t,e){return t.inline||e.appSpace[t.name].inline||ae(t,e)||Un(t,e)}function sr(t){return t.iframe?t.sandBox.microAppWindow:l.rawWindow}function Bn(t,e){const r=sr(t);return new r.Function(e)}function Wn(t,e,r){const n=e.appSpace;for(const o in n)if(o!==t.name){const i=n[o];if(i.parsedCode===r&&i.parsedFunction)return i.parsedFunction}}function ar(t,e,r){return Wn(t,e,r)||Bn(t,r)}function cr(){const t=En();return q.script.hasInfo(t)?cr():t}function Fn(t,e){e.forEach((r,n)=>{n==="type"&&r==="module"||n==="defer"||n==="async"||(n==="src"&&(n="data-origin-src"),l.rawSetAttribute.call(t,n,r))})}function lr(t,e){return t.useSandbox&&!ae(t,e)}function ur(t,e){return lr(t,e)?t.iframe?"iframe":"with":"disable"}function hr(t,e,r,n=!1){var o;let i=null,s=t.getAttribute("src");if(s&&(s=G(s,r.url)),t.hasAttribute("exclude")||gt(s,r.name))i=document.createComment("script element with exclude attribute removed by micro-app");else{if(t.type&&!Tn.includes(t.type)||t.hasAttribute("ignore")||wt(s,r.name))return!((o=l.rawDocument)===null||o===void 0)&&o.currentScript&&delete l.rawDocument.currentScript,null;if(l.supportModuleScript&&t.noModule||!l.supportModuleScript&&t.type==="module")i=document.createComment(`${t.noModule?"noModule":"module"} script ignored by micro-app`);else if(s){let a=q.script.getInfo(s);const c={async:t.hasAttribute("async"),defer:t.defer||t.type==="module",module:t.type==="module",inline:t.hasAttribute("inline"),pure:t.hasAttribute("pure"),attrs:ct(t)};if(a?a.appSpace[r.name]=a.appSpace[r.name]||c:a={code:"",isExternal:!0,appSpace:{[r.name]:c}},q.script.setInfo(s,a),!n)r.source.scripts.add(s),i=document.createComment(`script with src='${s}' extract by micro-app`);else return{address:s,scriptInfo:a}}else if(t.textContent){const a=cr(),c={code:t.textContent,isExternal:!1,appSpace:{[r.name]:{async:!1,defer:t.type==="module",module:t.type==="module",inline:t.hasAttribute("inline"),pure:t.hasAttribute("pure"),attrs:ct(t)}}};if(!n)r.source.scripts.add(a),q.script.setInfo(a,c),i=document.createComment("inline script extract by micro-app");else return{address:a,scriptInfo:c}}else n||(i=document.createComment("script element removed by micro-app"))}return n?{replaceComment:i}:e==null?void 0:e.replaceChild(i,t)}function dr(t){var e,r,n;const o=((e=R.options.plugins)===null||e===void 0?void 0:e.global)||[],i=((n=(r=R.options.plugins)===null||r===void 0?void 0:r.modules)===null||n===void 0?void 0:n[t])||[];return[...o,...i]}function gt(t,e){return t?(dr(e)||[]).some(n=>n.excludeChecker?n.excludeChecker(t):!1):!1}function wt(t,e){return t?(dr(e)||[]).some(n=>n.ignoreChecker?n.ignoreChecker(t):!1):!1}function Hn(t,e){const r=Array.from(e.source.scripts),n=[],o=[];for(const s of r){const a=q.script.getInfo(s),c=a.appSpace[e.name];(!c.defer&&!c.async||e.isPrefetch&&!e.isPrerender)&&(n.push(a.code?a.code:pe(s,e.name)),o.push([s,a]))}const i=e.isPrefetch||e.fiber?[]:null;n.length?ze(n,s=>{Oe(i,()=>$n(o[s.index][0],o[s.index][1],s.data,e))},s=>{D(s,e.name)},()=>{i?(i.push(()=>Promise.resolve(e.onLoad({html:t}))),Ce(i)):e.onLoad({html:t})}):e.onLoad({html:t})}function $n(t,e,r,n){if(e.code=r,n.isPrefetch&&n.prefetchLevel===2){const o=e.appSpace[n.name];if(!o.parsedCode&&(o.parsedCode=fr(t,n,r,e),o.sandboxType=ur(n,e),!Je(n,e)))try{o.parsedFunction=ar(n,e,o.parsedCode)}catch(i){D("Something went wrong while handling preloaded resources",n.name,`
`,i)}}}function jn(t,e){const r=t.fiber?[]:null,n=Array.from(t.source.scripts),o=[],i=[];for(const s of n){const a=q.script.getInfo(s),c=a.appSpace[t.name];c.defer||c.async?(a.isExternal&&!a.code&&!ae(t,a)?o.push(pe(s,t.name)):o.push(a.code),i.push([s,a]),ae(t,a)&&(e.moduleCount=e.moduleCount?++e.moduleCount:1)):Oe(r,()=>{qe(s,t,a),e(!1)})}o.length?ze(o,s=>{const a=i[s.index][1];a.code=a.code||s.data},s=>{e.errorCount=e.errorCount?++e.errorCount:1,D(s,t.name)},()=>{i.forEach(([s,a])=>{L(a.code)&&Oe(r,()=>{qe(s,t,a,e),!ae(t,a)&&e(!1)})}),r?(r.push(()=>Promise.resolve(e(de(e.moduleCount)||e.errorCount===o.length))),Ce(r)):e(de(e.moduleCount)||e.errorCount===o.length)}):r?(r.push(()=>Promise.resolve(e(!0))),Ce(r)):e(!0)}function qe(t,e,r,n,o){try{Vn(e);const i=r.appSpace[e.name],s=ur(e,r);if((!i.parsedCode||i.sandboxType!==s)&&(i.parsedCode=fr(t,e,r.code,r),i.sandboxType=s,i.parsedFunction=null),Je(e,r)){const a=o||K("script");if(qn(t,i.parsedCode,ae(e,r),a,i.attrs,n),!o){const c=e.iframe?e.sandBox.microBody:e.querySelector("micro-app-body");c==null||c.appendChild(a)}}else Qn(e,r)}catch(i){throw i}}function Gn(t,e,r,n){const o=Je(e,r)?K("script"):document.createComment("dynamic script extract by micro-app"),i=()=>Jt(n),s=()=>{const a=Object.getOwnPropertyDescriptor(l.rawDocument,"currentScript");(!a||a.configurable)&&Object.defineProperty(l.rawDocument,"currentScript",{value:n,configurable:!0}),qe(t,e,r,i,o),!ae(e,r)&&i()};return r.code||ae(e,r)?J(s):pe(t,e.name).then(a=>{r.code=a,s()}).catch(a=>{D(a,e.name),Zt(n)}),o}function Kn(t,e,r){const n=Je(e,r)?K("script"):document.createComment("dynamic script extract by micro-app");return qe(t,e,r,void 0,n),n}function qn(t,e,r,n,o,i){if(r){if(l.rawSetAttribute.call(n,"type","module"),Ie(t)?n.textContent=e:n.src=t,i){const s=()=>{i.moduleCount&&i.moduleCount--,i(i.moduleCount===0)};Ie(t)?J(s):n.onload=s}}else n.textContent=e;Fn(n,o)}function Qn(t,e){const r=e.appSpace[t.name];r.parsedFunction||(r.parsedFunction=ar(t,e,r.parsedCode)),r.parsedFunction.call(sr(t))}function fr(t,e,r,n){return T(R.options.plugins)&&(r=zn(t,r,e.name,R.options.plugins)),lr(e,n)?e.iframe?`(function(window,self,global,location){;${r}
${Ie(t)?"":`//# sourceURL=${t}
`}}).call(window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyLocation);`:`;(function(proxyWindow){with(proxyWindow.__MICRO_APP_WINDOW__){(function(${Ut}){;${r}
${Ie(t)?"":`//# sourceURL=${t}
`}}).call(proxyWindow,${Ut})}})(window.__MICRO_APP_PROXY_WINDOW__);`:r}function Vn(t){Xn(t)}function Xn(t){t.sandBox&&(l.rawWindow.__MICRO_APP_PROXY_WINDOW__=t.sandBox.proxyWindow)}function zn(t,e,r,n){var o;const i=Bt(n.global,e,t);return Bt((o=n.modules)===null||o===void 0?void 0:o[r],i,t)}function Bt(t,e,r){return k(t)?t.reduce((n,o)=>T(o)&&y(o.loader)?o.loader(n,r):n,e):e}function pr(t,e,r,n){const o=Array.from(t.children);o.length&&o.forEach(i=>{pr(i,e,r,n)});for(const i of o)Xt(i)?i.hasAttribute("exclude")||gt(i.getAttribute("href"),e.name)?t.replaceChild(document.createComment("link element with exclude attribute ignored by micro-app"),i):i.hasAttribute("ignore")||wt(i.getAttribute("href"),e.name)?i.hasAttribute("href")&&l.rawSetAttribute.call(i,"href",G(i.getAttribute("href"),e.url)):kt(i,t,e):dt(i)?i.hasAttribute("exclude")?t.replaceChild(document.createComment("style element with exclude attribute ignored by micro-app"),i):e.scopecss&&!i.hasAttribute("ignore")&&Oe(n,()=>_t(i,e)):Ee(i)?hr(i,t,e):dn(i)&&i.hasAttribute("src")&&l.rawSetAttribute.call(i,"src",G(i.getAttribute("src"),e.url))}function Yn(t,e){const r=e.parseHtmlString(t),n=l.rawElementQuerySelector.call(r,"micro-app-head"),o=l.rawElementQuerySelector.call(r,"micro-app-body");if(!n||!o){const a=`element ${n?"body":"head"} is missing`;return e.onerror(new Error(a)),D(a,e.name)}const i=e.isPrefetch||e.fiber?[]:null;pr(r,e,n,i);const s=Ce(i);e.source.links.size?Dn(r,e,n,s):s?s.then(()=>e.onLoad({html:r})):e.onLoad({html:r}),e.source.scripts.size?Hn(r,e):e.onLoad({html:r})}class Jn{constructor(){this.eventList=new Map,this.queue=[],this.recordStep={},this.process=()=>{var e,r;let n;const o=this.recordStep,i=this.queue;for(this.recordStep={},this.queue=[];n=i.shift();){const s=this.eventList.get(n),a=s.tempData,c=s.force;s.tempData=null,s.force=!1;let g;if(c||!this.isEqual(s.data,a)){s.data=a||s.data;for(const m of s.callbacks){const A=m(s.data);A&&(g??(g=[])).push(A)}(r=(e=o[n]).dispatchDataEvent)===null||r===void 0||r.call(e),o[n].nextStepList.forEach(m=>m(g))}}}}isLegalName(e){return e?!0:(D("event-center: Invalid name"),!1)}enqueue(e,r,n){this.recordStep[e]?(this.recordStep[e].nextStepList.push(r),n&&(this.recordStep[e].dispatchDataEvent=n)):this.recordStep[e]={nextStepList:[r],dispatchDataEvent:n},!this.queue.includes(e)&&this.queue.push(e)===1&&J(this.process)}isEqual(e,r){if(!r||Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&e[n]!==r[n])return!1;return!0}on(e,r,n=!1){if(this.isLegalName(e)){if(!y(r))return D("event-center: Invalid callback function");let o=this.eventList.get(e);o?n&&Object.keys(o.data).length&&(!this.queue.includes(e)||this.isEqual(o.data,o.tempData))&&r(o.data):(o={data:{},callbacks:new Set},this.eventList.set(e,o)),o.callbacks.add(r)}}off(e,r){if(this.isLegalName(e)){const n=this.eventList.get(e);n&&(y(r)?n.callbacks.delete(r):n.callbacks.clear())}}clearData(e){if(this.isLegalName(e)){const r=this.eventList.get(e);r&&(r.data={})}}dispatch(e,r,n,o,i){if(this.isLegalName(e)){if(!T(r))return D("event-center: data must be object");let s=this.eventList.get(e);s?(s.tempData=X({},s.tempData||s.data,r),!s.force&&(s.force=!!o)):(s={data:r,callbacks:new Set},this.eventList.set(e,s),s.force=!0),this.enqueue(e,n,i)}}getData(e){var r;const n=this.eventList.get(e);return(r=n==null?void 0:n.data)!==null&&r!==void 0?r:null}}const N=new Jn;function H(t,e){return!L(t)||!t?"":e?`__from_base_app_${t}__`:`__from_micro_app_${t}__`}class mr{addGlobalDataListener(e,r){const n=this.appName;n&&(e.__APP_NAME__=n,e.__AUTO_TRIGGER__=r),N.on("global",e,r)}removeGlobalDataListener(e){y(e)&&N.off("global",e)}setGlobalData(e,r,n){U(),N.dispatch("global",e,o=>y(r)&&r(o),n)}forceSetGlobalData(e,r){this.setGlobalData(e,r,!0)}getGlobalData(){return N.getData("global")}clearGlobalData(){N.clearData("global")}clearGlobalDataListener(){const e=this.appName,r=N.eventList.get("global");if(r)for(const n of r.callbacks)(e&&e===n.__APP_NAME__||!(e||n.__APP_NAME__))&&r.callbacks.delete(n)}}class Zn extends mr{addDataListener(e,r,n){N.on(H(W(e),!1),r,n)}removeDataListener(e,r){y(r)&&N.off(H(W(e),!1),r)}getData(e,r=!1){return N.getData(H(W(e),r))}setData(e,r,n,o){N.dispatch(H(W(e),!0),r,i=>y(n)&&n(i),o)}forceSetData(e,r,n){this.setData(e,r,n,!0)}clearData(e,r=!0){N.clearData(H(W(e),r))}clearDataListener(e){N.off(H(W(e),!1))}}class _r extends mr{constructor(e){super(),this.appName=W(e),!this.appName&&D(`Invalid appName ${e}`)}addDataListener(e,r){e.__AUTO_TRIGGER__=r,N.on(H(this.appName,!0),e,r)}removeDataListener(e){y(e)&&N.off(H(this.appName,!0),e)}getData(e=!0){return N.getData(H(this.appName,e))}dispatch(e,r,n){U(),N.dispatch(H(this.appName,!1),e,o=>y(r)&&r(o),n,()=>{const o=b.get(this.appName);if(o!=null&&o.container&&T(e)){const i=new CustomEvent("datachange",{detail:{data:N.getData(H(this.appName,!1))}});te(o.container).dispatchEvent(i)}})}forceDispatch(e,r){this.dispatch(e,r,!0)}clearData(e=!1){N.clearData(H(this.appName,e))}clearDataListener(){N.off(H(this.appName,!0))}}function Er(t){var e,r;if(t){t.umdDataListeners={global:new Set((e=t.umdDataListeners)===null||e===void 0?void 0:e.global),normal:new Set((r=t.umdDataListeners)===null||r===void 0?void 0:r.normal)};const n=N.eventList.get("global");if(n)for(const i of n.callbacks)t.appName===i.__APP_NAME__&&t.umdDataListeners.global.add(i);const o=N.eventList.get(H(t.appName,!0));if(o)for(const i of o.callbacks)t.umdDataListeners.normal.add(i)}}function gr(t){if(t!=null&&t.umdDataListeners){for(const e of t.umdDataListeners.global)t.addGlobalDataListener(e,e.__AUTO_TRIGGER__);for(const e of t.umdDataListeners.normal)t.addDataListener(e,e.__AUTO_TRIGGER__);At(t)}}function At(t){t==null||delete t.umdDataListeners}class Qe{constructor(){this.appInstanceMap=b}static getInstance(){return this.instance||(this.instance=new Qe),this.instance}get(e){return this.appInstanceMap.get(e)}set(e,r){this.appInstanceMap.set(e,r)}getAll(){return Array.from(this.appInstanceMap.values())}clear(){this.appInstanceMap.clear()}}function wr(){Ar(),Qe.getInstance().getAll().forEach(t=>{t.container&&te(t.container).disconnectedCallback()}),!window.__MICRO_APP_UMD_MODE__&&Qe.getInstance().clear()}function Ar(){window.__MICRO_APP_ENVIRONMENT__&&window.removeEventListener("unmount",wr,!1)}function kn(){window.__MICRO_APP_ENVIRONMENT__&&(Ar(),window.addEventListener("unmount",wr,!1))}function eo(t){return Qt(t.__MICRO_APP_IS_BOUND_FUNCTION__)?t.__MICRO_APP_IS_BOUND_FUNCTION__:t.__MICRO_APP_IS_BOUND_FUNCTION__=ln(t)}function to(t){return Qt(t.__MICRO_APP_IS_CONSTRUCTOR__)?t.__MICRO_APP_IS_CONSTRUCTOR__:t.__MICRO_APP_IS_CONSTRUCTOR__=ht(t)}function Q(t,e,r="WINDOW"){if(y(t)&&!to(t)&&!eo(t)){const n=`__MICRO_APP_BOUND_${r}_FUNCTION__`;if(t[n])return t[n];const o=t.bind(e);for(const i in t)o[i]=t[i];return t.hasOwnProperty("prototype")&&F(o,"prototype",{value:t.prototype,configurable:!0,enumerable:!1,writable:!0}),t[n]=o}return t}function ro(t,e,r){const{proxyDocument:n,documentEffect:o}=no(t,r),i=oo(t,n);return oe(e,{document:{configurable:!1,enumerable:!0,get(){return n}},Document:{configurable:!1,enumerable:!1,get(){return i}}}),o}function no(t,e){const r=new Map,n=new Map;let o=null,i=null;const{rawDocument:s,rawCreateElement:a,rawCreateElementNS:c,rawAddEventListener:g,rawRemoveEventListener:m}=l;function A(u,h){const E=a.call(s,u,h);return E.__MICRO_APP_NAME__=t,E}function P(u,h,E){const I=c.call(s,u,h,E);return I.__MICRO_APP_NAME__=t,I}function M(u,h,E){const I=r.get(u);I?I.add(h):r.set(u,new Set([h])),h&&(h.__MICRO_APP_MARK_OPTIONS__=E),g.call(s,u,h,E)}function O(u,h,E){const I=r.get(u);I!=null&&I.size&&I.has(h)&&I.delete(h),m.call(s,u,h,E)}const v=()=>{n.clear(),i=null},S=()=>{i=o||i,r.forEach((u,h)=>{if(u.size){const E=n.get(h)||[];n.set(h,new Set([...E,...u]))}})},_=()=>{i&&!o&&(w.onclick=i),n.forEach((u,h)=>{for(const E of u)w.addEventListener(h,E,E==null?void 0:E.__MICRO_APP_MARK_OPTIONS__)}),v()},p=()=>{y(o)&&m.call(s,"click",o),o=null,r.size&&(r.forEach((u,h)=>{for(const E of u)m.call(s,h,E)}),r.clear())},f=(()=>{var u;const h=new Map([["onclick",Pe=>{y(o)&&m.call(s,"click",o,!1),y(Pe)&&g.call(s,"click",Pe,!1),o=Pe}]]),E=((u=R.options)===null||u===void 0?void 0:u.customProxyDocumentProps)||new Map;return new Map([...h,...E])})(),w=new Proxy(s,{get:(u,h)=>{var E;return fe(t),h==="createElement"?A:h==="createElementNS"?P:h===Symbol.toStringTag?"ProxyDocument":h==="defaultView"?e.proxyWindow:h==="onclick"?o:h==="addEventListener"?M:h==="removeEventListener"?O:h==="microAppElement"?(E=b.get(t))===null||E===void 0?void 0:E.container:h==="__MICRO_APP_NAME__"?t:Q(Reflect.get(u,h),s,"DOCUMENT")},set:(u,h,E)=>(f.has(h)?f.get(h)(E):h!=="microAppElement"&&Reflect.set(u,h,E),!0)});return{proxyDocument:w,documentEffect:{reset:v,record:S,rebuild:_,release:p}}}function oo(t,e){const{rawDocument:r,rawRootDocument:n}=l;class o{static[Symbol.hasInstance](s){let a=s;for(;a;)if(a=Object.getPrototypeOf(a),a===o.prototype)return!0;return s===e||s instanceof n}}return Object.setPrototypeOf(o,n),Object.setPrototypeOf(o.prototype,new Proxy(n.prototype,{get(i,s){return fe(t),Q(Reflect.get(i,s),r,"DOCUMENT")},set(i,s,a){return Reflect.set(i,s,a),!0}})),o}function io(t,e,r){return so(e),ao(t,e,r),co(e,t)}function so(t){const e=l.rawWindow;Object.getOwnPropertyNames(e).filter(r=>/^on/.test(r)&&!or.includes(r)).forEach(r=>{const{enumerable:n,writable:o,set:i}=Object.getOwnPropertyDescriptor(e,r)||{enumerable:!0,writable:!0};F(t,r,{enumerable:n,configurable:!0,get:()=>e[r],set:o??!!i?s=>{e[r]=s}:void 0})})}function ao(t,e,r){const n=l.rawWindow,o=new Map,i=new Proxy(e,{get:(s,a)=>(fe(t),Reflect.has(s,a)||L(a)&&/^__MICRO_APP_/.test(a)||V(r.scopeProperties,a)?(V(xn,a)&&U(),Reflect.get(s,a)):Q(Reflect.get(n,a),n)),set:(s,a,c)=>{if(V(r.rawWindowScopeKeyList,a))Reflect.set(n,a,c);else if(!ue.call(s,a)&&ue.call(n,a)&&!V(r.scopeProperties,a)){const g=Object.getOwnPropertyDescriptor(n,a),{configurable:m,enumerable:A,writable:P,set:M}=g;F(s,a,{value:c,configurable:m,enumerable:A,writable:P??!!M}),r.injectedKeys.add(a)}else(!Reflect.has(s,a)||V(r.scopeProperties,a))&&r.injectedKeys.add(a),Reflect.set(s,a,c);return(V(r.escapeProperties,a)||V(r.staticEscapeProperties,a)&&!Reflect.has(n,a))&&!V(r.scopeProperties,a)&&(!Reflect.has(n,a)&&r.escapeKeys.add(a),Reflect.set(n,a,c)),!0},has:(s,a)=>V(r.scopeProperties,a)?r.injectedKeys.has(a)?Reflect.has(s,a):!!s[a]:Reflect.has(s,a)||Reflect.has(n,a),getOwnPropertyDescriptor:(s,a)=>{if(ue.call(s,a))return o.set(a,"target"),Object.getOwnPropertyDescriptor(s,a);if(ue.call(n,a)){o.set(a,"rawWindow");const c=Object.getOwnPropertyDescriptor(n,a);return c&&!c.configurable&&(c.configurable=!0),c}},defineProperty:(s,a,c)=>o.get(a)==="rawWindow"?Reflect.defineProperty(n,a,c):Reflect.defineProperty(s,a,c),ownKeys:s=>gn(Reflect.ownKeys(n).concat(Reflect.ownKeys(s))),deleteProperty:(s,a)=>ue.call(s,a)?(r.injectedKeys.has(a)&&r.injectedKeys.delete(a),r.escapeKeys.has(a)&&Reflect.deleteProperty(n,a),Reflect.deleteProperty(s,a)):!0});r.proxyWindow=i}function co(t,e){const r=new Map,n=new Map,o=new Map,i=new Map,{rawWindow:s,rawAddEventListener:a,rawRemoveEventListener:c,rawDispatchEvent:g,rawSetInterval:m,rawSetTimeout:A,rawClearInterval:P,rawClearTimeout:M}=l;function O(d){var f;return nr.includes(d)&&(!((f=b.get(e))===null||f===void 0)&&f.container)?te(b.get(e).container):s}t.addEventListener=function(d,f,w){const u=r.get(d);u?u.add(f):r.set(d,new Set([f])),f&&(f.__MICRO_APP_MARK_OPTIONS__=w),a.call(O(d),d,f,w)},t.removeEventListener=function(d,f,w){const u=r.get(d);u!=null&&u.size&&u.has(f)&&u.delete(f),c.call(O(d),d,f,w)},t.dispatchEvent=function(d){return g.call(O(d==null?void 0:d.type),d)},t.setInterval=function(d,f,...w){const u=m.call(s,d,f,...w);return o.set(u,{handler:d,timeout:f,args:w}),u},t.setTimeout=function(d,f,...w){const u=A.call(s,d,f,...w);return i.set(u,{handler:d,timeout:f,args:w}),u},t.clearInterval=function(d){o.delete(d),P.call(s,d)},t.clearTimeout=function(d){i.delete(d),M.call(s,d)};const v=()=>{n.clear()};return{reset:v,record:()=>{r.forEach((d,f)=>{if(d.size){const w=n.get(f)||[];n.set(f,new Set([...w,...d]))}})},rebuild:()=>{n.forEach((d,f)=>{for(const w of d)t.addEventListener(f,w,w==null?void 0:w.__MICRO_APP_MARK_OPTIONS__)}),v()},release:d=>{r.size&&(r.forEach((f,w)=>{for(const u of f)c.call(O(w),w,u)}),r.clear()),d&&(o.forEach((f,w)=>{P.call(s,w)}),i.forEach((f,w)=>{M.call(s,w)}),o.clear(),i.clear())}}}function Ne(t,e){if(z(t)){const r=l.rawWindow.history.state,n={microAppState:X({},r==null?void 0:r.microAppState,{[t]:e})};return X({},r,n)}return e}function lo(t,e){return z(t)?(T(e==null?void 0:e.microAppState)&&(de(e.microAppState[t])||delete e.microAppState[t],Object.keys(e.microAppState).length||delete e.microAppState),X({},e)):e}function We(t){var e;const r=l.rawWindow.history.state;return z(t)?((e=r==null?void 0:r.microAppState)===null||e===void 0?void 0:e[t])||null:r}const uo=/&/g,ho=/=/g,vr=/%M1/g,br=/%M2/g;function Pr(t){return encodeURIComponent(vt(t).replace(uo,"%M1").replace(ho,"%M2"))}function Rr(t){return vt(t).replace(vr,"&").replace(br,"=")}function vt(t){try{const e=decodeURIComponent(t);return t===e||vr.test(e)||br.test(e)?e:vt(e)}catch{return t}}function Fe(t){var e,r;if(ve(t))return null;const n=l.rawWindow.location;if(z(t)){const o=bt(n.search,n.hash),i=((e=o.hashQuery)===null||e===void 0?void 0:e[t])||((r=o.searchQuery)===null||r===void 0?void 0:r[t]);return L(i)?Rr(i):null}return n.pathname+n.search+n.hash}function ce(t,e){const r=e.pathname+e.search+e.hash;let n=!1;if(z(t)){let{pathname:o,search:i,hash:s}=l.rawWindow.location;const a=bt(i,s),c=Pr(r);return s&&!i?(n=!0,a.hashQuery?a.hashQuery[t]=c:a.hashQuery={[t]:c},s=(s.includes("?")?s.slice(0,s.indexOf("?")+1):s+"?")+Ge(a.hashQuery)):(a.searchQuery?a.searchQuery[t]=c:a.searchQuery={[t]:c},i="?"+Ge(a.searchQuery)),{fullPath:o+i+s,isAttach2Hash:n}}return{fullPath:r,isAttach2Hash:n}}function fo(t,e){var r,n,o,i;let{pathname:s,search:a,hash:c}=e||l.rawWindow.location,g=!1;if(z(t)){const m=bt(a,c);if(!((r=m.hashQuery)===null||r===void 0)&&r[t]){g=!0,(n=m.hashQuery)===null||n===void 0||delete n[t];const A=Ge(m.hashQuery);c=c.slice(0,c.indexOf("?")+ +!!A)+A}else if(!((o=m.searchQuery)===null||o===void 0)&&o[t]){(i=m.searchQuery)===null||i===void 0||delete i[t];const A=Ge(m.searchQuery);a=A?"?"+A:""}}return{fullPath:s+a+c,isAttach2Hash:g}}function bt(t,e){const r={};return t!==""&&t!=="?"&&(r.searchQuery=Ot(t.slice(1))),e.includes("?")&&(r.hashQuery=Ot(e.slice(e.indexOf("?")+1))),r}function po(t,e){const r=Fe(t);if(!r)return"";const n=x(r,e);return n.origin+n.pathname+n.search}function xe(t){const e=b.get(t);return!!(e&&!e.isPrefetch)}function z(t){const e=b.get(t);return!!(e&&e.sandBox&&e.routerMode===Le)}function Sr(t){const e=b.get(t);return!!(e&&e.sandBox&&e.routerMode===Ke)}function mo(t){const e=b.get(t);return!!(e&&e.sandBox&&e.routerMode===tr)}function ve(t){const e=b.get(t);return!!(e&&e.sandBox&&e.routerMode===rr)}function he(t){return Sr(t)||mo(t)}function yr(t,e){const r=e&&Ke||t||R.options["disable-memory-router"]&&Ke||R.options["router-mode"]||Le;return In.includes(r)?r:Le}function Mr(t){const e=l.rawWindow,r=n=>{we({excludeHiddenApp:!0,excludePreRender:!0}).includes(t)&&!n.onlyForBrowser&&Dr(t,Fe(t))};return e.addEventListener("popstate",r),()=>{e.removeEventListener("popstate",r)}}function Dr(t,e){const r=b.get(t),n=r.sandBox.proxyWindow,o=r.sandBox.microAppWindow;let i=!1;const s=n.location.href;if(e){const a=n.location.hash;be(t,e,o.location),i=n.location.hash!==a}_o(t,n,o),i&&Eo(t,n,o,s),U()}function _o(t,e,r){const n=new PopStateEvent("popstate",{state:We(t)});r.dispatchEvent(n),$e(t)||y(e.onpopstate)&&e.onpopstate(n)}function Eo(t,e,r,n){const o=new HashChangeEvent("hashchange",{newURL:e.location.href,oldURL:n});r.dispatchEvent(o),$e(t)||y(e.onhashchange)&&e.onhashchange(o)}function go(t){const e=new PopStateEvent("popstate",{state:null});t&&(e.onlyForBrowser=!0),l.rawWindow.dispatchEvent(e)}function wo(t){const e=new HashChangeEvent("hashchange",{newURL:l.rawWindow.location.href,oldURL:t});l.rawWindow.dispatchEvent(e)}function lt(t,e,r){U(),xe(t)&&(go(e),r&&wo(r))}function Or(t,e){const r=l.rawWindow.history;function n(s){return function(...a){var c,g,m;if(L(a[2])||Be(a[2])){const A=x(a[2],e.href),P=A.pathname+A.search+A.hash;ve(t)||Ze(t,s,ce(t,A),!0,Ne(t,a[0]),a[1]),P!==e.fullPath&&be(t,P,e),(m=(c=b.get(t))===null||c===void 0?void 0:(g=c.sandBox).updateIframeBase)===null||m===void 0||m.call(g)}else De(t,s,a[2],a[0],a[1])}}const o=n("pushState"),i=n("replaceState");return $e(t)?{pushState:o,replaceState:i}:new Proxy(r,{get(s,a){return a==="state"?We(t):a==="pushState"?o:a==="replaceState"?i:Q(Reflect.get(s,a),s,"HISTORY")},set(s,a,c){return Reflect.set(s,a,c),!0}})}function De(t,e,r,n=null,o=""){xe(t)&&(e==="pushState"?l.rawPushState:l.rawReplaceState).call(l.rawWindow.history,n,o,r)}function Ze(t,e,r,n,o,i){if(xe(t)){const s=l.rawWindow.location,a=s.pathname+s.search+s.hash,c=r.isAttach2Hash&&a!==r.fullPath?s.href:null;De(t,e,r.fullPath,o,i),a!==r.fullPath&&z(t)&&lt(t,n,c)}}function ke(t,e,r){Ze(t,"replaceState",e,!0,r)}function Wt(t){const e=l.rawWindow;return function(...r){var n;if(!((n=e.history.state)===null||n===void 0)&&n.microAppState&&(!T(r[0])||!r[0].microAppState)&&(L(r[2])||Be(r[2]))){const o=e.location.href;x(r[2],o).href===o&&(r[0]=X({},r[0],{microAppState:e.history.state.microAppState}))}t.apply(e.history,r),we({excludeHiddenApp:!0,excludePreRender:!0}).forEach(o=>{if(z(o)&&!Fe(o)){const i=b.get(o);ke(o,ce(o,i.sandBox.proxyWindow.location),Ne(o,We(o)))}}),U()}}function Cr(){const t=l.rawWindow;t.history.pushState=Wt(l.rawPushState),t.history.replaceState=Wt(l.rawReplaceState)}function Ir(){const t=l.rawWindow;t.history.pushState=l.rawPushState,t.history.replaceState=l.rawReplaceState}function Ao(){function t(v,S,_,p){Ze(v,S,ce(v,_),!1,Ne(v,p??null)),U()}function e(v,S,_,p){const d=S.sandBox.proxyWindow.location,f=x(_.path,d.href),w=d.pathname+d.search+d.hash,u=f.pathname+f.search+f.hash;if(w!==u||Fe(v)!==u){if(!ve(v)){const h=p&&_.replace!==!1||_.replace===!0?"replaceState":"pushState";t(v,h,f,_.state)}(he(v)||ve(v))&&Dr(v,u)}}function r(v){return function(S){return new Promise((_,p)=>{const d=W(S.name);if(d&&L(S.path))if(we({excludeHiddenApp:!0,excludePreRender:!0}).includes(d)){const f=b.get(d);_(f.sandBox.sandboxReady.then(()=>e(d,f,S,v)))}else p(D("navigation failed, app does not exist or is inactive"));else p(D(`navigation failed, name & path are required when use router.${v?"replace":"push"}`))})}}function n(v){return function(...S){return l.rawWindow.history[v](...S)}}const o=Ct(),i=Ct();function s(v,S,_,p){U();for(const d of p)y(d)?d(S,_,v):T(d)&&y(d[v])&&d[v](S,_)}function a(v,S,_){O.current.set(v,S),s(v,S,_,o.list()),Ye(()=>{s(v,S,_,i.list())})}function c(v){O.current.delete(v)}function g(v){if(z(v)){const S=b.get(v);ke(v,ce(v,S.sandBox.proxyWindow.location),Ne(v,We(v)))}}function m(v){v=W(v),v&&we().includes(v)&&g(v)}function A({includeHiddenApp:v=!1,includePreRender:S=!1}){we({excludeHiddenApp:!v,excludePreRender:!S}).forEach(_=>g(_))}function P(){const v=wn();function S(p){const d=W(p.name);return!d||!p.path?an:v.add(d,p.path)}function _(p){return p=W(p),p?v.delete(p):!1}return{setDefaultPage:S,removeDefaultPage:_,getDefaultPage:v.get}}function M(){let v=null;function S(_){Vt(_)&&(v=new Proxy(_,{get(p,d){return U(),Q(Reflect.get(p,d),p,"BASEROUTER")},set(p,d,f){return Reflect.set(p,d,f),!0}}))}return{setBaseAppRouter:S,getBaseAppRouter:()=>v}}const O=Object.assign(Object.assign({current:new Map,encode:Pr,decode:Rr,push:r(!1),replace:r(!0),go:n("go"),back:n("back"),forward:n("forward"),beforeEach:o.add,afterEach:i.add,attachToURL:m,attachAllToURL:A},P()),M());return{router:O,executeNavigationGuard:a,clearRouterWhenUnmount:c}}const{router:He,executeNavigationGuard:Lr,clearRouterWhenUnmount:vo}=Ao(),bo=["getComputedStyle","visualViewport","matchMedia","ResizeObserver","IntersectionObserver"],Po=[/animationFrame$/i,/mutationObserver$/i,/height$|width$/i,/offset$/i,/selection$/i,/^range/i,/^screen/i,/^scroll/i,/X$|Y$/],Ro=["body","head","html","title"],So=["host","hostname","port","protocol","origin"],yo=["childElementCount","children","firstElementChild","firstChild","lastElementChild","activeElement","fullscreenElement","pictureInPictureElement","pointerLockElement","styleSheets"],Mo=["append","contains","replaceChildren","createRange","getSelection","elementFromPoint","elementsFromPoint","getAnimations"],Do=["characterSet","compatMode","contentType","designMode","dir","doctype","embeds","fullscreenEnabled","hidden","implementation","lastModified","pictureInPictureEnabled","plugins","readyState","referrer","visibilityState","fonts"],Oo=["execCommand","createRange","exitFullscreen","exitPictureInPicture","getElementsByTagNameNS","hasFocus","prepend"],Co=["href","pathname","search","hash","host","hostname","port","protocol","search"],Io=[...Co,"origin","fullPath"];function Nr(t,e,r,n,o,i){const a=l.rawWindow.location,c=!!r,g=x(e);function m(){return c?r.location:g}function A(p,d){const f=x(p,_.href);if(f.origin===_.origin){const w=ce(t,f);if(z(t)){if(f.pathname===_.pathname&&f.search===_.search){let u=null;f.hash!==_.hash&&(w.isAttach2Hash&&(u=a.href),De(t,d,w.fullPath)),f.hash?lt(t,!1,u):S();return}else if(w.isAttach2Hash){De(t,d,w.fullPath),S();return}}return w.fullPath}return p}function P(p,d){const f=x(p,e);f[d]===_[d]&&_.hash?lt(t,!1):(De(t,f[d]===_[d]?"replaceState":"pushState",ce(t,f).fullPath),S())}const M=p=>function(d){if(xe(t)){const f=A(d,p==="assign"?"pushState":"replaceState");f&&a[p](x(f,a.origin).href)}},O=M("assign"),v=M("replace"),S=p=>a.reload(p);F(m(),"fullPath",{enumerable:!0,configurable:!0,get:()=>_.pathname+_.search+_.hash});const _=new Proxy({},{get:(p,d)=>{const f=m();if(d==="assign")return O;if(d==="replace")return v;if(d==="reload")return S;if(d==="self")return f;if(d==="fullPath")return f.fullPath;if(Sr(t))return Q(Reflect.get(a,d),a,"LOCATION");if(c){if(So.includes(d))return n[d];if(d==="href")return f[d].replace(o,i)}return Q(Reflect.get(f,d),f,"LOCATION")},set:(p,d,f)=>{if(xe(t)){const w=m();if(d==="href"){const u=A(f,"pushState");u&&(a.href=x(u,a.origin).href)}else if(d==="pathname")if(he(t))a.pathname=f;else{const u=("/"+f).replace(/^\/+/,"/")+_.search+_.hash;P(u,"pathname")}else if(d==="search")if(he(t))a.search=f;else{const u=_.pathname+("?"+f).replace(/^\?+/,"?")+_.hash;P(u,"search")}else if(d==="hash")if(he(t))a.hash=f;else{const u=_.pathname+_.search+("#"+f).replace(/^#+/,"#"),h=x(u,e);h.hash!==_.hash&&Ze(t,"pushState",ce(t,h),!1)}else Reflect.set(w,d,f)}return!0}});return _}function Ve(t,e){const r=X({name:t},e);for(const n of Io)r[n]=e[n];return r}function Lo(t,e){Lr(t,Ve(t,e),Ve(t,e))}function be(t,e,r,n){var o;const i=Ve(t,r),s=x(e,r.href);if($e(t)){const c=b.get(t).sandBox.microAppWindow;(o=c.rawReplaceState)===null||o===void 0||o.call(c.history,We(t),"",s.href)}else{let c=s.href;r.self.origin!==s.origin&&(c=c.replace(s.origin,r.self.origin)),r.self.href=c}const a=Ve(t,r);(n==="auto"||i.fullPath!==a.fullPath&&n!=="prevent")&&Lr(t,a,i)}function No(t,e){const r=Nr(t,e);return{microLocation:r,microHistory:Or(t,r)}}function xr(t,e,r){const n=Fe(t);n?be(t,n,e,"auto"):Pt(t,e,r)}function Pt(t,e,r){r&&be(t,r,e,"prevent"),ve(t)||ke(t,ce(t,e),Ne(t,null)),Lo(t,e)}function Tr(t,e,r,n){if(!he(t)){if(!n){const{pathname:o,search:i,hash:s}=x(e);be(t,o+i+s,r,"prevent")}ve(t)||Rt(t)}vo(t)}function Rt(t){ke(t,fo(t),lo(t,l.rawWindow.history.state))}class xo{constructor(){this.rawWindowScopeKeyList=["location"],this.staticEscapeProperties=["System","__cjsWrapper"],this.staticScopeProperties=["webpackJsonp","webpackHotUpdate","Vue","onpopstate","onhashchange"],this.scopeProperties=Array.from(this.staticScopeProperties),this.escapeProperties=[],this.injectedKeys=new Set,this.escapeKeys=new Set,this.injectReactHMRProperty()}injectReactHMRProperty(){}}class To{}function Uo(){l.rawWindow._babelPolyfill&&(l.rawWindow._babelPolyfill=!1)}function St(t,e){const r=Array.from(t.children);r.length&&r.forEach(n=>{St(n,e)});for(const n of r)$(n,e)}function $(t,e){var r,n;const o=(n=(r=b.get(e))===null||r===void 0?void 0:r.sandBox)===null||n===void 0?void 0:n.proxyWindow;return Ae(t)&&!t.__MICRO_APP_NAME__&&!t.__PURE_ELEMENT__&&o&&oe(t,{baseURI:{configurable:!0,get:()=>o.location.href},__MICRO_APP_NAME__:{configurable:!0,writable:!0,value:e}}),t}function Ft(t,e){const r=de(e)?l.rawWindow.fetch:e;return y(r)?function(o,i,...s){return(L(o)||Be(o))&&(o=x(o,t).toString()),U(),r.call(l.rawWindow,o,i,...s)}:r}function Ht(t,e){const r=de(e)?l.rawWindow.XMLHttpRequest:e;return ht(r)?class extends r{open(o,i,...s){(L(i)&&!/^f(ile|tp):\/\//.test(i)||Be(i))&&(i=x(i,t).toString()),U(),super.open(o,i,...s)}}:r}function Bo(){let t;function e(n,o,i){const s=de(i)?l.rawWindow.EventSource:i;return ht(s)?class extends s{constructor(c,g,...m){if((L(c)||Be(c))&&(c=x(c,o).toString()),U(),super(c,g,...m),t){const A=t.get(n);A?A.add(this):t.set(n,new Set([this]))}else t=new Map([[n,new Set([this])]])}close(){var c;super.close(),(c=t.get(n))===null||c===void 0||c.delete(this)}}:s}function r(n){const o=t==null?void 0:t.get(n);o!=null&&o.size&&(o.forEach(i=>{i.close()}),o.clear())}return{createMicroEventSource:e,clearMicroEventSource:r}}const{createMicroEventSource:$t,clearMicroEventSource:Wo}=Bo();class Te extends xo{constructor(e,r){super(),this.active=!1,this.microAppWindow=new To,this.patchWith(n=>{this.getSpecialProperties(e),this.patchRouter(e,r,this.microAppWindow),this.windowEffect=io(e,this.microAppWindow,this),this.documentEffect=ro(e,this.microAppWindow,this),this.setMappingPropertiesWithRawDescriptor(this.microAppWindow),this.initStaticGlobalKeys(e,r,this.microAppWindow),n()})}start({umdMode:e,baseroute:r,defaultPage:n,disablePatchRequest:o}){this.active||(this.active=!0,this.initRouteState(n),this.removeHistoryListener=Mr(this.microAppWindow.__MICRO_APP_NAME__),he(this.microAppWindow.__MICRO_APP_NAME__)&&(this.microAppWindow.__MICRO_APP_BASE_ROUTE__=this.microAppWindow.__MICRO_APP_BASE_URL__=r),e||this.initGlobalKeysWhenStart(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.__MICRO_APP_URL__,this.microAppWindow,o),++l.activeSandbox===1&&($r(),Cr()),++Te.activeCount===1&&kn(),Uo())}stop({umdMode:e,keepRouteState:r,destroy:n,clearData:o}){var i;this.active&&(this.recordAndReleaseEffect({umdMode:e,clearData:o,destroy:n},!e||n),this.clearRouteState(r),(i=this.removeHistoryListener)===null||i===void 0||i.call(this),(!e||n)&&(Wo(this.microAppWindow.__MICRO_APP_NAME__),this.injectedKeys.forEach(s=>{Reflect.deleteProperty(this.microAppWindow,s)}),this.injectedKeys.clear(),this.escapeKeys.forEach(s=>{Reflect.deleteProperty(l.rawWindow,s)}),this.escapeKeys.clear()),--l.activeSandbox===0&&(jr(),Ir()),--Te.activeCount,this.active=!1)}initStaticGlobalKeys(e,r,n){n.__MICRO_APP_ENVIRONMENT__=!0,n.__MICRO_APP_NAME__=e,n.__MICRO_APP_URL__=r,n.__MICRO_APP_PUBLIC_PATH__=Xe(r),n.__MICRO_APP_BASE_ROUTE__="",n.__MICRO_APP_WINDOW__=n,n.__MICRO_APP_PRE_RENDER__=!1,n.__MICRO_APP_UMD_MODE__=!1,n.__MICRO_APP_PROXY_WINDOW__=this.proxyWindow,n.__MICRO_APP_SANDBOX__=this,n.__MICRO_APP_SANDBOX_TYPE__="with",n.rawWindow=l.rawWindow,n.rawDocument=l.rawDocument,n.microApp=X(new _r(e),{removeDomScope:U,pureCreateElement:K,router:He})}recordAndReleaseEffect(e,r=!1){r?this.resetEffectSnapshot():this.recordEffectSnapshot(),this.releaseGlobalEffect(e)}resetEffectSnapshot(){this.windowEffect.reset(),this.documentEffect.reset(),At(this.microAppWindow.microApp)}recordEffectSnapshot(){this.windowEffect.record(),this.documentEffect.record(),Er(this.microAppWindow.microApp)}rebuildEffectSnapshot(){this.windowEffect.rebuild(),this.documentEffect.rebuild(),gr(this.microAppWindow.microApp)}releaseGlobalEffect({umdMode:e=!1,clearData:r=!1,isPrerender:n=!1,keepAlive:o=!1,destroy:i=!1}){var s,a,c;this.windowEffect.release(!e&&!o&&!n||i),this.documentEffect.release(),(s=this.microAppWindow.microApp)===null||s===void 0||s.clearDataListener(),(a=this.microAppWindow.microApp)===null||a===void 0||a.clearGlobalDataListener(),r&&(R.clearData(this.microAppWindow.__MICRO_APP_NAME__),(c=this.microAppWindow.microApp)===null||c===void 0||c.clearData())}getSpecialProperties(e){var r;T(R.options.plugins)&&(this.commonActionForSpecialProperties(R.options.plugins.global),this.commonActionForSpecialProperties((r=R.options.plugins.modules)===null||r===void 0?void 0:r[e]))}commonActionForSpecialProperties(e){if(k(e))for(const r of e)T(r)&&(k(r.scopeProperties)&&(this.scopeProperties=this.scopeProperties.concat(r.scopeProperties)),k(r.escapeProperties)&&(this.escapeProperties=this.escapeProperties.concat(r.escapeProperties)))}setPreRenderState(e){this.microAppWindow.__MICRO_APP_PRE_RENDER__=e}markUmdMode(e){this.microAppWindow.__MICRO_APP_UMD_MODE__=e}patchWith(e){this.sandboxReady=new Promise(r=>e(r))}setMappingPropertiesWithRawDescriptor(e){let r,n;const o=l.rawWindow;o===o.parent?r=n=this.proxyWindow:(r=o.top,n=o.parent),oe(e,{top:this.createDescriptorForMicroAppWindow("top",r),parent:this.createDescriptorForMicroAppWindow("parent",n)}),ir.forEach(i=>{F(e,i,this.createDescriptorForMicroAppWindow(i,this.proxyWindow))})}createDescriptorForMicroAppWindow(e,r){const{configurable:n=!0,enumerable:o=!0,writable:i,set:s}=Object.getOwnPropertyDescriptor(l.rawWindow,e)||{writable:!0};return{value:r,configurable:n,enumerable:o,writable:i??!!s}}initGlobalKeysWhenStart(e,r,n,o){n.hasOwnProperty=i=>ue.call(n,i)||ue.call(l.rawWindow,i),this.setHijackProperty(e,n),o||this.patchRequestApi(e,r,n),this.setScopeProperties(n)}setHijackProperty(e,r){let n,o;oe(r,{eval:{configurable:!0,enumerable:!1,get(){return fe(e),n||l.rawWindow.eval},set:i=>{n=i}},Image:{configurable:!0,enumerable:!1,get(){return fe(e),o||l.ImageProxy},set:i=>{o=i}}})}patchRequestApi(e,r,n){let o=Ft(r),i=Ht(r),s=$t(e,r);oe(n,{fetch:{configurable:!0,enumerable:!0,get(){return o},set(a){o=Ft(r,a)}},XMLHttpRequest:{configurable:!0,enumerable:!0,get(){return i},set(a){i=Ht(r,a)}},EventSource:{configurable:!0,enumerable:!0,get(){return s},set(a){s=$t(e,r,a)}}})}setScopeProperties(e){this.scopeProperties.forEach(r=>{Reflect.set(e,r,e[r])})}patchRouter(e,r,n){const{microLocation:o,microHistory:i}=No(e,r);oe(n,{location:{configurable:!1,enumerable:!0,get(){return o},set:s=>{l.rawWindow.location=s}},history:{configurable:!0,enumerable:!0,get(){return i}}})}initRouteState(e){xr(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location,e)}clearRouteState(e){Tr(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.__MICRO_APP_URL__,this.microAppWindow.location,e)}setRouteInfoForKeepAliveApp(){Pt(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location)}removeRouteInfoForKeepAliveApp(){Rt(this.microAppWindow.__MICRO_APP_NAME__)}patchStaticElement(e){St(e,this.microAppWindow.__MICRO_APP_NAME__)}actionBeforeExecScripts(e){this.patchStaticElement(e)}setStaticAppState(e){this.microAppWindow.__MICRO_APP_STATE__=e}}Te.activeCount=0;function Fo(t,e,r,n){const o=x(e),i=o.protocol+"//"+o.host,s=o.pathname+o.search+o.hash,a=r.history;return r.rawReplaceState=a.replaceState,X(a,Or(t,r.location)),be(t,s,r.location,"prevent"),Nr(t,e,r,o,n,i)}function Ho(t,e,r){return $o(t,e),jo(e,r),Go(e)}function $o(t,e){const r=l.rawWindow;bo.forEach(n=>{e[n]=Q(r[n],r)}),Object.getOwnPropertyNames(e).filter(n=>(Po.some(o=>{if(o.test(n)&&n in e.parent){if(y(r[n]))e[n]=Q(r[n],r);else{const{configurable:i,enumerable:s}=Object.getOwnPropertyDescriptor(e,n)||{configurable:!0,enumerable:!0};i&&F(e,n,{configurable:i,enumerable:s,get:()=>r[n],set:a=>{r[n]=a}})}return!0}return!1}),/^on/.test(n)&&!or.includes(n))).forEach(n=>{const{enumerable:o,writable:i,set:s}=Object.getOwnPropertyDescriptor(e,n)||{enumerable:!0,writable:!0};try{F(e,n,{enumerable:o,configurable:!0,get:()=>r[n],set:i??!!s?a=>{r[n]=y(a)?a.bind(e):a}:void 0})}catch(a){le(a,t)}})}function jo(t,e){const r=l.rawWindow,n=new Set,o=new Proxy(t,{get:(i,s)=>s==="location"?e.proxyLocation:V(ir,s)?o:n.has(s)?Reflect.get(i,s):V(e.escapeProperties,s)&&!Reflect.has(i,s)?Q(Reflect.get(r,s),r):Q(Reflect.get(i,s),i),set:(i,s,a)=>s==="location"?Reflect.set(r,s,a):(Reflect.has(i,s)||n.add(s),Reflect.set(i,s,a),V(e.escapeProperties,s)&&(!Reflect.has(r,s)&&e.escapeKeys.add(s),Reflect.set(r,s,a)),!0),has:(i,s)=>s in i,deleteProperty:(i,s)=>Reflect.has(i,s)?(e.escapeKeys.has(s)&&Reflect.deleteProperty(r,s),Reflect.deleteProperty(i,s)):!0});e.proxyWindow=o}function Go(t){const{rawWindow:e,rawAddEventListener:r,rawRemoveEventListener:n}=l,o=new Map,i=new Map;function s(A){return nr.includes(A)?t:e}t.addEventListener=function(A,P,M){const O=o.get(A);O?O.add(P):o.set(A,new Set([P])),P&&(P.__MICRO_APP_MARK_OPTIONS__=M),r.call(s(A),A,P,M)},t.removeEventListener=function(A,P,M){const O=o.get(A);O!=null&&O.size&&O.has(P)&&O.delete(P),n.call(s(A),A,P,M)};const a=()=>{i.clear()};return{reset:a,record:()=>{o.forEach((A,P)=>{if(A.size){const M=i.get(P)||[];i.set(P,new Set([...M,...A]))}})},rebuild:()=>{i.forEach((A,P)=>{for(const M of A)t.addEventListener(P,M,M==null?void 0:M.__MICRO_APP_MARK_OPTIONS__)}),a()},release:()=>{o.size&&(o.forEach((A,P)=>{for(const M of A)n.call(s(P),P,M)}),o.clear())}}}function Ko(t,e,r){return qo(t,e),Qo(t,e,r),Vo(t,e)}function qo(t,e){const r=l.rawDocument,n=e.Document,o=e.document,i=n.prototype.createElement,s=n.prototype.createElementNS,a=n.prototype.createTextNode,c=n.prototype.createDocumentFragment,g=n.prototype.createComment,m=n.prototype.querySelector,A=n.prototype.querySelectorAll,P=n.prototype.getElementById,M=n.prototype.getElementsByClassName,O=n.prototype.getElementsByTagName,v=n.prototype.getElementsByName,S=n.prototype.elementFromPoint,_=n.prototype.caretRangeFromPoint;n.prototype.caretRangeFromPoint=function(u,h){const E=S.call(r,u,h),I=_.call(r,u,h);return $(E,t),I},n.prototype.createElement=function(u,h){const E=i.call(this,u,h);return $(E,t)},n.prototype.createElementNS=function(u,h,E){const I=s.call(this,u,h,E);return $(I,t)},n.prototype.createTextNode=function(u){const h=a.call(this,u);return $(h,t)},n.prototype.createDocumentFragment=function(){const u=c.call(this);return $(u,t)},n.prototype.createComment=function(u){const h=g.call(this,u);return $(h,t)};function p(w){return o!==w?w:r}function d(w){var u,h;if(!w||ge(w)||o!==this){const E=p(this);return m.call(E,w)}return(h=(u=b.get(t))===null||u===void 0?void 0:u.querySelector(w))!==null&&h!==void 0?h:null}function f(w){var u,h;if(!w||ge(w)||o!==this){const E=p(this);return A.call(E,w)}return(h=(u=b.get(t))===null||u===void 0?void 0:u.querySelectorAll(w))!==null&&h!==void 0?h:[]}n.prototype.querySelector=d,n.prototype.querySelectorAll=f,n.prototype.getElementById=function(u){const h=p(this);if(ie(u))return P.call(h,u);try{return d.call(this,`#${u}`)}catch{return P.call(h,u)}},n.prototype.getElementsByClassName=function(u){const h=p(this);if(ie(u))return M.call(h,u);try{return f.call(this,`.${u}`)}catch{return M.call(h,u)}},n.prototype.getElementsByTagName=function(u){const h=p(this);if(ge(u)||ie(u))return O.call(h,u);if(/^script|base$/i.test(u))return O.call(o,u);try{return f.call(this,u)}catch{return O.call(h,u)}},n.prototype.getElementsByName=function(u){const h=p(this);if(ie(u))return v.call(h,u);try{return f.call(this,`[name=${u}]`)}catch{return v.call(h,u)}}}function Qo(t,e,r){const n=l.rawDocument,o=e.Document,i=e.document,s=(c,g)=>{const{enumerable:m}=Object.getOwnPropertyDescriptor(o.prototype,c)||{enumerable:!0};return{configurable:!0,enumerable:m,get:g}},a=()=>{const c={};return[["documentURI",()=>r.proxyLocation.href],["URL",()=>r.proxyLocation.href],["documentElement",()=>n.documentElement],["scrollingElement",()=>n.scrollingElement],["forms",()=>o.prototype.querySelectorAll.call(i,"form")],["images",()=>o.prototype.querySelectorAll.call(i,"img")],["links",()=>o.prototype.querySelectorAll.call(i,"a")],["microAppElement",()=>{var m;return(m=b.get(t))===null||m===void 0?void 0:m.container}],["__MICRO_APP_NAME__",()=>t]].forEach(m=>{c[m[0]]=s(m[0],m[1])}),yo.forEach(m=>{c[m]=s(m,()=>n[m])}),Mo.forEach(m=>{c[m]=s(m,()=>Q(n[m],n,"DOCUMENT"))}),Do.forEach(m=>{c[m]=s(m,()=>n[m])}),Oo.forEach(m=>{c[m]=s(m,()=>Q(n[m],n,"DOCUMENT"))}),c};oe(o.prototype,a()),Ro.forEach(c=>{F(i,c,{enumerable:!0,configurable:!0,get:()=>(fe(t),n[c]),set:g=>{n[c]=g}})})}function Vo(t,e){const{rawDocument:r,rawAddEventListener:n,rawRemoveEventListener:o}=l,i=new Map,s=new Map;let a=null,c=null;const g=e.Document,m=e.document;function A(_,p){return Ln.includes(_)?p:r}g.prototype.addEventListener=function(_,p,d){const f=y(p)?p.__MICRO_APP_BOUND_FUNCTION__=p.__MICRO_APP_BOUND_FUNCTION__||p.bind(this):p,w=i.get(_);w?w.add(p):i.set(_,new Set([p])),p&&(p.__MICRO_APP_MARK_OPTIONS__=d),n.call(A(_,this),_,f,d)},g.prototype.removeEventListener=function(_,p,d){const f=i.get(_);f!=null&&f.size&&f.has(p)&&f.delete(p);const w=(p==null?void 0:p.__MICRO_APP_BOUND_FUNCTION__)||p;o.call(A(_,this),_,w,d)};function P(_){return _==="onclick"?p=>{y(a)&&o.call(r,"click",a,!1),y(p)?(a=p.bind(m),n.call(r,"click",a,!1)):a=p}:p=>{r[_]=y(p)?p.bind(m):p}}Object.getOwnPropertyNames(g.prototype).filter(_=>/^on/.test(_)&&!Nn.includes(_)).forEach(_=>{const{enumerable:p,writable:d,set:f}=Object.getOwnPropertyDescriptor(g.prototype,_)||{enumerable:!0,writable:!0};try{F(g.prototype,_,{enumerable:p,configurable:!0,get:()=>_==="onclick"?a:r[_],set:d??!!f?P(_):void 0})}catch(w){le(w,t)}});const M=()=>{s.clear(),c=null};return{reset:M,record:()=>{c=a||c,i.forEach((_,p)=>{if(_.size){const d=s.get(p)||[];s.set(p,new Set([...d,..._]))}})},rebuild:()=>{c&&!a&&(m.onclick=c),s.forEach((_,p)=>{for(const d of _)m.addEventListener(p,d,d==null?void 0:d.__MICRO_APP_MARK_OPTIONS__)}),M()},release:()=>{y(a)&&o.call(r,"click",a),a=null,i.size&&(i.forEach((_,p)=>{for(const d of _)o.call(A(p,m),p,(d==null?void 0:d.__MICRO_APP_BOUND_FUNCTION__)||d)}),i.clear())}}}function Xo(t,e,r,n){zo(t,r,n),Yo(e,r)}function zo(t,e,r){const n=l.rawRootElement,o=l.rawDocument,i=e.document,s=e.Node,a=e.Element,c=s.prototype.appendChild,g=s.prototype.insertBefore,m=s.prototype.replaceChild,A=s.prototype.removeChild,P=a.prototype.append,M=a.prototype.prepend,O=a.prototype.insertAdjacentElement,v=s.prototype.cloneNode,S=Object.getOwnPropertyDescriptor(a.prototype,"innerHTML"),_=Object.getOwnPropertyDescriptor(s.prototype,"parentNode"),p=Object.getOwnPropertyDescriptor(s.prototype,"ownerDocument"),d=u=>(Ee(u)||fn(u))&&u.__PURE_ELEMENT__,f=u=>u===r.microHead?o.head:u===r.microBody?o.body:u;s.prototype.getRootNode=function(){return i},s.prototype.appendChild=function(h){return $(h,t),d(h)?c.call(this,h):n.prototype.appendChild.call(f(this),h)},s.prototype.insertBefore=function(h,E){return $(h,t),d(h)?g.call(this,h,E):n.prototype.insertBefore.call(f(this),h,E)},s.prototype.replaceChild=function(h,E){return $(h,t),d(h)?m.call(this,h,E):n.prototype.replaceChild.call(f(this),h,E)},s.prototype.removeChild=function(h){return d(h)||this.contains(h)?A.call(this,h):n.prototype.removeChild.call(f(this),h)},a.prototype.append=function(...h){let E=0,I=!1;for(;E<h.length;)h[E]=Ae(h[E])?h[E]:i.createTextNode(h[E]),d(h[E])&&(I=!0),E++;return I?P.call(this,...h):n.prototype.append.call(f(this),...h)},a.prototype.prepend=function(...h){let E=0,I=!1;for(;E<h.length;)h[E]=Ae(h[E])?h[E]:i.createTextNode(h[E]),d(h[E])&&(I=!0),E++;return I?M.call(this,...h):n.prototype.prepend.call(f(this),...h)},a.prototype.insertAdjacentElement=function(h,E){return $(E,t),d(E)?O.call(this,h,E):n.prototype.insertAdjacentElement.call(f(this),h,E)},s.prototype.cloneNode=function(h){const E=v.call(this,h);return $(E,t)},F(s.prototype,"ownerDocument",{configurable:!0,enumerable:!0,get(){return this.__PURE_ELEMENT__?p.get.call(this):i}}),F(a.prototype,"innerHTML",{configurable:!0,enumerable:!0,get(){return S.get.call(this)},set(u){S.set.call(this,u),Array.from(this.children).forEach(h=>{se(h)&&$(h,t)})}}),F(s.prototype,"parentNode",{configurable:!0,enumerable:!0,get(){var u,h,E;fe(t);const I=_.get.call(this);return it(I)&&(!((u=b.get(t))===null||u===void 0)&&u.container)?((E=(h=R.options).getRootElementParentNode)===null||E===void 0?void 0:E.call(h,this,t))||l.rawDocument.body:I}});const w=new Proxy(e.Image,{construct(u,h){const E=new u(...h);return $(E,t),E}});F(e,"Image",{configurable:!0,writable:!0,value:w})}function Yo(t,e){const r=e.Element,n=r.prototype.setAttribute;r.prototype.setAttribute=function(s,a){((s==="src"||s==="srcset")&&/^(img|script)$/i.test(this.tagName)||s==="href"&&/^link$/i.test(this.tagName))&&(a=G(a,t)),n.call(this,s,a)},[[e.HTMLImageElement.prototype,"src"],[e.HTMLScriptElement.prototype,"src"],[e.HTMLLinkElement.prototype,"href"]].forEach(([i,s])=>{const{enumerable:a,configurable:c,get:g,set:m}=Object.getOwnPropertyDescriptor(i,s)||{enumerable:!0,configurable:!0};F(i,s,{enumerable:a,configurable:c,get:function(){return g==null?void 0:g.call(this)},set:function(A){m==null||m.call(this,G(A,t))}})})}class Ue{constructor(e,r){this.active=!1,this.escapeProperties=[],this.escapeKeys=new Set,this.updateIframeBase=()=>{var i;(i=this.baseElement)===null||i===void 0||i.setAttribute("href",x(this.url).origin+this.proxyLocation.pathname)},this.appName=e,this.url=r;const n=l.rawWindow.location,o=n.protocol+"//"+n.host;this.deleteIframeElement=this.createIframeElement(e,o+n.pathname),this.microAppWindow=this.iframe.contentWindow,this.patchIframe(this.microAppWindow,i=>{this.createIframeTemplate(this.microAppWindow),this.getSpecialProperties(e),this.proxyLocation=Fo(e,r,this.microAppWindow,o),this.windowEffect=Ho(e,this.microAppWindow,this),this.documentEffect=Ko(e,this.microAppWindow,this),Xo(e,r,this.microAppWindow,this),this.initStaticGlobalKeys(e,r,this.microAppWindow),i()})}createIframeElement(e,r){this.iframe=K("iframe");const n={src:R.options.iframeSrc||r,style:"display: none",id:e};return Object.keys(n).forEach(o=>this.iframe.setAttribute(o,n[o])),l.rawDocument.body.appendChild(this.iframe),()=>J(()=>{var o,i;(i=(o=this.iframe)===null||o===void 0?void 0:o.parentNode)===null||i===void 0||i.removeChild(this.iframe),this.iframe=null})}start({baseroute:e,defaultPage:r,disablePatchRequest:n}){this.active||(this.active=!0,this.initRouteState(r),this.removeHistoryListener=Mr(this.microAppWindow.__MICRO_APP_NAME__),he(this.microAppWindow.__MICRO_APP_NAME__)&&(this.microAppWindow.__MICRO_APP_BASE_ROUTE__=this.microAppWindow.__MICRO_APP_BASE_URL__=e),n||this.createIframeBase(),++l.activeSandbox===1&&($r(),Cr()),++Ue.activeCount)}stop({umdMode:e,keepRouteState:r,destroy:n,clearData:o}){var i;this.active&&(this.recordAndReleaseEffect({clearData:o},!e||n),this.clearRouteState(r),(i=this.removeHistoryListener)===null||i===void 0||i.call(this),(!e||n)&&(this.deleteIframeElement(),this.escapeKeys.forEach(s=>{Reflect.deleteProperty(l.rawWindow,s)}),this.escapeKeys.clear()),--l.activeSandbox===0&&(jr(),Ir()),--Ue.activeCount,this.active=!1)}initStaticGlobalKeys(e,r,n){n.__MICRO_APP_ENVIRONMENT__=!0,n.__MICRO_APP_NAME__=e,n.__MICRO_APP_URL__=r,n.__MICRO_APP_PUBLIC_PATH__=Xe(r),n.__MICRO_APP_BASE_ROUTE__="",n.__MICRO_APP_WINDOW__=n,n.__MICRO_APP_PRE_RENDER__=!1,n.__MICRO_APP_UMD_MODE__=!1,n.__MICRO_APP_PROXY_WINDOW__=this.proxyWindow,n.__MICRO_APP_SANDBOX__=this,n.__MICRO_APP_SANDBOX_TYPE__="iframe",n.rawWindow=l.rawWindow,n.rawDocument=l.rawDocument,n.microApp=X(new _r(e),{removeDomScope:U,pureCreateElement:K,location:this.proxyLocation,router:He})}recordAndReleaseEffect(e,r=!1){r?this.resetEffectSnapshot():this.recordEffectSnapshot(),this.releaseGlobalEffect(e)}resetEffectSnapshot(){var e,r;(e=this.windowEffect)===null||e===void 0||e.reset(),(r=this.documentEffect)===null||r===void 0||r.reset(),At(this.microAppWindow.microApp)}recordEffectSnapshot(){var e,r;(e=this.windowEffect)===null||e===void 0||e.record(),(r=this.documentEffect)===null||r===void 0||r.record(),Er(this.microAppWindow.microApp)}rebuildEffectSnapshot(){var e,r;(e=this.windowEffect)===null||e===void 0||e.rebuild(),(r=this.documentEffect)===null||r===void 0||r.rebuild(),gr(this.microAppWindow.microApp)}releaseGlobalEffect({clearData:e=!1}){var r,n,o,i,s;(r=this.windowEffect)===null||r===void 0||r.release(),(n=this.documentEffect)===null||n===void 0||n.release(),(o=this.microAppWindow.microApp)===null||o===void 0||o.clearDataListener(),(i=this.microAppWindow.microApp)===null||i===void 0||i.clearGlobalDataListener(),e&&(R.clearData(this.microAppWindow.__MICRO_APP_NAME__),(s=this.microAppWindow.microApp)===null||s===void 0||s.clearData())}setPreRenderState(e){this.microAppWindow.__MICRO_APP_PRE_RENDER__=e}markUmdMode(e){this.microAppWindow.__MICRO_APP_UMD_MODE__=e}patchIframe(e,r){const n=e.document;this.sandboxReady=new Promise(o=>{(function i(){setTimeout(()=>{try{e.document===n?i():(e.stop(),r(o))}catch{i()}},0)})()})}createIframeTemplate(e){const r=e.document;An(r);const n=r.createElement("html");n.innerHTML="<head></head><body></body>",r.appendChild(n),this.microBody=r.body,this.microHead=r.head}createIframeBase(){this.baseElement=K("base"),this.updateIframeBase(),this.microHead.appendChild(this.baseElement)}getSpecialProperties(e){var r;T(R.options.plugins)&&(this.commonActionForSpecialProperties(R.options.plugins.global),this.commonActionForSpecialProperties((r=R.options.plugins.modules)===null||r===void 0?void 0:r[e]))}commonActionForSpecialProperties(e){if(k(e))for(const r of e)T(r)&&k(r.escapeProperties)&&(this.escapeProperties=this.escapeProperties.concat(r.escapeProperties))}initRouteState(e){xr(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location,e)}clearRouteState(e){Tr(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.__MICRO_APP_URL__,this.microAppWindow.location,e)}setRouteInfoForKeepAliveApp(){Pt(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location)}removeRouteInfoForKeepAliveApp(){Rt(this.microAppWindow.__MICRO_APP_NAME__)}patchStaticElement(e){St(e,this.microAppWindow.__MICRO_APP_NAME__)}actionBeforeExecScripts(e){this.patchStaticElement(e)}setStaticAppState(e){this.microAppWindow.__MICRO_APP_STATE__=e}}Ue.activeCount=0;const b=new Map;class Ur{constructor({name:e,url:r,container:n,scopecss:o,useSandbox:i,inline:s,iframe:a,ssrUrl:c,isPrefetch:g,prefetchLevel:m,routerMode:A}){this.state=B.CREATED,this.keepAliveState=null,this.loadSourceLevel=0,this.umdHookMount=null,this.umdHookUnmount=null,this.lifeCycleState=null,this.umdMode=!1,this.sandBox=null,this.fiber=!1,b.set(e,this),this.name=e,this.url=r,this.useSandbox=i,this.scopecss=this.useSandbox&&o,this.iframe=a??!1,this.inline=this.getInlineModeState(s),this.routerMode=A||Le,this.container=n??null,this.ssrUrl=c??"",this.isPrefetch=g??!1,this.isPrerender=m===3,this.prefetchLevel=m,this.source={html:null,links:new Set,scripts:new Set},this.loadSourceCode(),this.createSandbox()}loadSourceCode(){this.setAppState(B.LOADING),mt.getInstance().run(this,Yn)}onLoad({html:e,defaultPage:r,routerMode:n,baseroute:o,disablePatchRequest:i}){var s;if(++this.loadSourceLevel===2){if(this.source.html=e,!this.isPrefetch&&!this.isUnmounted())te(this.container).mount(this);else if(this.isPrerender){const a=K("div");a.setAttribute("prerender","true"),(s=this.sandBox)===null||s===void 0||s.setPreRenderState(!0),this.mount({container:a,inline:this.inline,fiber:!0,defaultPage:r||"",disablePatchRequest:i??!1,routerMode:n,baseroute:o||""})}}}onLoadError(e){this.loadSourceLevel=-1,this.isUnmounted()||(this.onerror(e),this.setAppState(B.LOAD_FAILED))}mount({container:e,inline:r,routerMode:n,defaultPage:o,baseroute:i,disablePatchRequest:s,fiber:a}){if(this.loadSourceLevel!==2)return this.container=e,this.isPrerender=!1,Z(this,"statechange",{appState:B.LOADING}),this.setAppState(B.LOADING);this.createSandbox(),this.setAppState(B.BEFORE_MOUNT);const c=()=>{var g,m,A,P,M,O,v;if(this.isPrerender&&hn(this.container)&&this.container.hasAttribute("prerender"))(g=this.sandBox)===null||g===void 0||g.rebuildEffectSnapshot(),this.cloneContainer(e,this.container,!1),this.container=e,(m=this.preRenderEvents)===null||m===void 0||m.forEach(S=>S()),this.isPrerender=!1,this.preRenderEvents=null,He.attachToURL(this.name),(A=this.sandBox)===null||A===void 0||A.setPreRenderState(!1);else{this.container=e,this.inline=this.getInlineModeState(r),this.fiber=a,this.routerMode=n;const S=()=>{this.setLifeCycleState(C.BEFOREMOUNT),ne(this.container,this.name,C.BEFOREMOUNT)};if(this.isPrerender?((P=this.preRenderEvents)!==null&&P!==void 0?P:this.preRenderEvents=[]).push(S):S(),this.setAppState(B.MOUNTING),Z(this,"statechange",{appState:B.MOUNTING}),this.cloneContainer(this.container,this.source.html,!this.umdMode),(M=this.sandBox)===null||M===void 0||M.start({umdMode:this.umdMode,baseroute:i,defaultPage:o,disablePatchRequest:s}),!this.umdMode)(O=this.sandBox)===null||O===void 0||O.actionBeforeExecScripts(this.container),jn(this,_=>{if(!this.umdMode){const{mount:p,unmount:d}=this.getUmdLibraryHooks();if(this.umdHookUnmount=d,y(p)&&y(d)){this.umdHookMount=p,this.sandBox.markUmdMode(this.umdMode=!0);try{this.handleMounted(this.umdHookMount(R.getData(this.name,!0)))}catch(f){D(`An error occurred in window.mount 
`,this.name,f)}}else _===!0&&this.handleMounted()}});else{(v=this.sandBox)===null||v===void 0||v.rebuildEffectSnapshot();try{this.handleMounted(this.umdHookMount(R.getData(this.name,!0)))}catch(_){D(`An error occurred in window.mount 
`,this.name,_)}}}};this.sandBox?this.sandBox.sandboxReady.then(c):c()}handleMounted(e){var r,n;const o=()=>{ot(e)?e.then(()=>this.dispatchMountedEvent()).catch(i=>{D(`An error occurred in window.mount 
`,this.name,i),this.dispatchMountedEvent()}):this.dispatchMountedEvent()};this.isPrerender?((r=this.preRenderEvents)===null||r===void 0||r.push(o),(n=this.sandBox)===null||n===void 0||n.recordAndReleaseEffect({isPrerender:!0})):o()}dispatchMountedEvent(){var e;this.isUnmounted()||(this.setAppState(B.MOUNTED),It(this.getMicroAppGlobalHook(me.ONMOUNT),this.name,me.ONMOUNT,R.getData(this.name,!0)),Z(this,"statechange",{appState:B.MOUNTED}),Z(this,"mounted"),this.setLifeCycleState(C.MOUNTED),ne(this.container,this.name,C.MOUNTED),this.isHidden()&&((e=this.sandBox)===null||e===void 0||e.recordAndReleaseEffect({keepAlive:!0})))}unmount({destroy:e,clearData:r,keepRouteState:n,unmountcb:o}){var i;e=e||this.state===B.LOAD_FAILED,this.setAppState(B.UNMOUNT);let s=null;try{s=(i=this.umdHookUnmount)===null||i===void 0?void 0:i.call(this,R.getData(this.name,!0))}catch(a){D(`An error occurred in window.unmount 
`,this.name,a)}Z(this,"statechange",{appState:B.UNMOUNT}),Z(this,"unmount"),It(this.getMicroAppGlobalHook(me.ONUNMOUNT),this.name,me.ONUNMOUNT),this.handleUnmounted({destroy:e,clearData:r,keepRouteState:n,unmountcb:o,umdHookUnmountResult:s})}handleUnmounted({destroy:e,clearData:r,keepRouteState:n,unmountcb:o,umdHookUnmountResult:i}){const s=()=>this.actionsForUnmount({destroy:e,clearData:r,keepRouteState:n,unmountcb:o});ot(i)?(U(),i.then(s).catch(s)):s()}actionsForUnmount({destroy:e,clearData:r,keepRouteState:n,unmountcb:o}){var i;this.umdMode&&this.container&&!e&&this.cloneContainer(this.source.html,this.container,!1),(i=this.sandBox)===null||i===void 0||i.stop({umdMode:this.umdMode,keepRouteState:n&&!e,destroy:e,clearData:r||e}),this.setLifeCycleState(C.UNMOUNT),ne(this.container,this.name,C.UNMOUNT),this.clearOptions(e),o==null||o()}clearOptions(e){this.container.innerHTML="",this.container=null,this.isPrerender=!1,this.preRenderEvents=null,this.setKeepAliveState(null),this.iframe&&!this.umdMode&&(this.sandBox=null),e&&this.actionsForCompletelyDestroy(),U()}actionsForCompletelyDestroy(){var e,r;(r=(e=this.sandBox)===null||e===void 0?void 0:e.deleteIframeElement)===null||r===void 0||r.call(e),q.script.deleteInlineInfo(this.source.scripts),b.delete(this.name)}hiddenKeepAliveApp(e){var r,n;this.setKeepAliveState(Me.KEEP_ALIVE_HIDDEN),Z(this,"appstate-change",{appState:"afterhidden"}),this.setLifeCycleState(C.AFTERHIDDEN),ne(this.container,this.name,C.AFTERHIDDEN),z(this.name)&&((r=this.sandBox)===null||r===void 0||r.removeRouteInfoForKeepAliveApp()),this.loadSourceLevel!==2?te(this.container).unmount():(this.container=this.cloneContainer(K("div"),this.container,!1),(n=this.sandBox)===null||n===void 0||n.recordAndReleaseEffect({keepAlive:!0})),e==null||e()}showKeepAliveApp(e){var r,n;(r=this.sandBox)===null||r===void 0||r.rebuildEffectSnapshot(),Z(this,"appstate-change",{appState:"beforeshow"}),ne(e,this.name,C.BEFORESHOW),this.setKeepAliveState(Me.KEEP_ALIVE_SHOW),this.container=this.cloneContainer(e,this.container,!1),z(this.name)&&((n=this.sandBox)===null||n===void 0||n.setRouteInfoForKeepAliveApp()),Z(this,"appstate-change",{appState:"aftershow"}),this.setLifeCycleState(C.AFTERSHOW),ne(this.container,this.name,C.AFTERSHOW)}onerror(e){this.setLifeCycleState(C.ERROR),Z(this,"statechange",{appState:B.LOAD_FAILED}),ne(this.container,this.name,C.ERROR,e)}parseHtmlString(e){var r;const n=!((r=this.sandBox)===null||r===void 0)&&r.proxyWindow?this.sandBox.proxyWindow.DOMParser:l.rawWindow.DOMParser;return new n().parseFromString(e,"text/html").body}cloneContainer(e,r,n){return r&&(e.innerHTML="",Array.from(n?this.parseHtmlString(r.innerHTML).childNodes:r.childNodes).forEach(o=>{e.appendChild(o)})),e}createSandbox(){this.useSandbox&&!this.sandBox&&(this.sandBox=this.iframe?new Ue(this.name,this.url):new Te(this.name,this.url))}setAppState(e){var r;this.state=e,(r=this.sandBox)===null||r===void 0||r.setStaticAppState(e)}getAppState(){return this.state}setLifeCycleState(e){this.lifeCycleState=e}getLifeCycleState(){return this.lifeCycleState||""}setKeepAliveState(e){this.keepAliveState=e}getKeepAliveState(){return this.keepAliveState}isUnmounted(){return B.UNMOUNT===this.state}isHidden(){return Me.KEEP_ALIVE_HIDDEN===this.keepAliveState}getUmdLibraryHooks(){if(!this.isUnmounted()&&this.sandBox){const e=te(this.container).getAttribute("library")||`micro-app-${this.name}`,r=this.sandBox.proxyWindow;return Vt(r[e])?r[e]:{mount:r.mount,unmount:r.unmount}}return{}}getMicroAppGlobalHook(e){var r,n;const o=(n=(r=this.sandBox)===null||r===void 0?void 0:r.proxyWindow)===null||n===void 0?void 0:n[e];return y(o)?o:null}querySelector(e){return this.container?l.rawElementQuerySelector.call(this.container,e):null}querySelectorAll(e){return this.container?l.rawElementQuerySelectorAll.call(this.container,e):[]}getInlineModeState(e){var r;return(r=this.iframe||e)!==null&&r!==void 0?r:!1}}function $e(t){var e,r;return(r=(e=b.get(t))===null||e===void 0?void 0:e.iframe)!==null&&r!==void 0?r:!1}const ee=new WeakMap;function Br(t){var e;return(e=ee.get(t))!==null&&e!==void 0?e:t}function Wr(t,e){if(ee.has(t))return ee.get(t);if(dt(t)){if(t.hasAttribute("exclude")){const r=document.createComment("style element with exclude attribute ignored by micro-app");return ee.set(t,r),r}else if(e.scopecss&&!t.hasAttribute("ignore"))return _t(t,e);return t}else if(Xt(t)){if(t.hasAttribute("exclude")||gt(t.getAttribute("href"),e.name)){const i=document.createComment("link element with exclude attribute ignored by micro-app");return ee.set(t,i),i}else if(t.hasAttribute("ignore")||wt(t.getAttribute("href"),e.name)||t.href&&y(R.options.excludeAssetFilter)&&R.options.excludeAssetFilter(t.href))return t;const{address:r,linkInfo:n,replaceComment:o}=kt(t,null,e,!0);if(r&&n){const i=Cn(r,e,n,t);return ee.set(t,i),i}else if(o)return ee.set(t,o),o;return t}else if(Ee(t)){if(t.src&&y(R.options.excludeAssetFilter)&&R.options.excludeAssetFilter(t.src))return t;const{replaceComment:r,address:n,scriptInfo:o}=hr(t,null,e,!0)||{};if(n&&o){const i=o.isExternal?Gn(n,e,o,t):Kn(n,e,o);return ee.set(t,i),i}else if(r)return ee.set(t,r),r;return t}return t}function Fr(t,e,r,n,o){const i=Hr(r,n,t);if(i){if(!$e(t.name)&&it(i)&&e!==l.rawRemoveChild){const s=Object.getOwnPropertyDescriptor(n,"parentNode");(!s||s.configurable)&&!n.__MICRO_APP_HAS_DPN__&&oe(n,{parentNode:{configurable:!0,get(){var a,c;const g=l.rawParentNodeDesc.get.call(this);return it(g)&&t.container?((c=(a=R.options).getRootElementParentNode)===null||c===void 0?void 0:c.call(a,this,t.name))||document.body:g}},__MICRO_APP_HAS_DPN__:{configurable:!0,get:()=>!0}})}if(o&&!i.contains(o)){if(e===l.rawInsertBefore&&r.contains(o)){const s=Array.from(r.childNodes).indexOf(o);if(i.childNodes[s])return tt(e,i,n,i.childNodes[s])}return l.rawAppendChild.call(i,n)}else if(e===l.rawRemoveChild&&!i.contains(n))return r.contains(n)?e.call(r,n):n;return tt(e,i,n,o)}return tt(e,r,n,o)}function Hr(t,e,r){if(r){if(t===document.head)return r.iframe&&Ee(e)?r.sandBox.microHead:r.querySelector("micro-app-head");if(t===document.body||t===document.body.parentNode)return r.iframe&&Ee(e)?r.sandBox.microBody:r.querySelector("micro-app-body");if(r.iframe&&Ee(e))return r.sandBox.microBody}return null}function tt(t,e,r,n){return Jo(t)?t.call(e,r):t.call(e,r,n)}function Jo(t){return t===l.rawAppend||t===l.rawPrepend}function Zo(t,e){se(e)&&(/^(img|script)$/i.test(e.tagName)?(e.hasAttribute("src")&&l.rawSetAttribute.call(e,"src",G(e.getAttribute("src"),t.url)),e.hasAttribute("srcset")&&l.rawSetAttribute.call(e,"srcset",G(e.getAttribute("srcset"),t.url))):/^link$/i.test(e.tagName)&&e.hasAttribute("href")&&l.rawSetAttribute.call(e,"href",G(e.getAttribute("href"),t.url)))}function Re(t,e,r,n){const o=j();if(Ae(e)&&!e.__PURE_ELEMENT__&&(e.__MICRO_APP_NAME__||o)){e.__MICRO_APP_NAME__=e.__MICRO_APP_NAME__||o;const i=b.get(e.__MICRO_APP_NAME__);if(dt(e)&&t.getRootNode()instanceof ShadowRoot&&e.setAttribute("ignore","true"),i!=null&&i.container)return Zo(i,e),Fr(i,n,t,Wr(e,i),r&&Br(r))}return n===l.rawAppend||n===l.rawPrepend?n.call(t,e):n.call(t,e,r)}function $r(){ko();const t=l.rawRootElement,e=l.rawRootNode;t.prototype.appendChild=function(o){return Re(this,o,null,l.rawAppendChild)},t.prototype.insertBefore=function(o,i){return Re(this,o,i,l.rawInsertBefore)},t.prototype.replaceChild=function(o,i){return Re(this,o,i,l.rawReplaceChild)},t.prototype.append=function(...o){let i=0;for(;i<o.length;){let s=o[i];s=Ae(s)?s:l.rawCreateTextNode.call(l.rawDocument,s),Re(this,_e(s),null,l.rawAppend),i++}},t.prototype.prepend=function(...o){let i=o.length;for(;i>0;){let s=o[i-1];s=Ae(s)?s:l.rawCreateTextNode.call(l.rawDocument,s),Re(this,_e(s),null,l.rawPrepend),i--}},t.prototype.removeChild=function(o){if(o!=null&&o.__MICRO_APP_NAME__){const i=b.get(o.__MICRO_APP_NAME__);if(i!=null&&i.container)return Fr(i,l.rawRemoveChild,this,Br(o));try{return l.rawRemoveChild.call(this,o)}catch{return(o==null?void 0:o.parentNode)&&l.rawRemoveChild.call(o.parentNode,o)}}return l.rawRemoveChild.call(this,o)},t.prototype.insertAdjacentElement=function(n,o){var i;if(o!=null&&o.__MICRO_APP_NAME__&&se(o)){const s=b.get(o.__MICRO_APP_NAME__);if(s!=null&&s.container){const a=Wr(o,s);if(!se(a))return o;const c=(i=Hr(this,a,s))!==null&&i!==void 0?i:this;return l.rawInsertAdjacentElement.call(c,n,a)}}return l.rawInsertAdjacentElement.call(this,n,o)},t.prototype.cloneNode=function(o){const i=l.rawCloneNode.call(this,o);return this.__MICRO_APP_NAME__&&(i.__MICRO_APP_NAME__=this.__MICRO_APP_NAME__),i};function r(n){const o=j();if((n===document.body||n===document.head)&&o){const i=b.get(o);if(i!=null&&i.container){if(n===document.body)return i.querySelector("micro-app-body");if(n===document.head)return i.querySelector("micro-app-head")}}return n}t.prototype.querySelector=function(o){var i;return l.rawElementQuerySelector.call((i=r(this))!==null&&i!==void 0?i:this,o)},t.prototype.querySelectorAll=function(o){var i;return l.rawElementQuerySelectorAll.call((i=r(this))!==null&&i!==void 0?i:this,o)},t.prototype.setAttribute=function(o,i){const s=this.__MICRO_APP_NAME__||j();if(s&&b.has(s)&&((o==="src"||o==="srcset")&&/^(img|script|video|audio|source|embed)$/i.test(this.tagName)||o==="href"&&/^link$/i.test(this.tagName))){const a=b.get(s);i=G(i,a.url)}l.rawSetAttribute.call(this,o,i)},F(t.prototype,"innerHTML",{configurable:!0,enumerable:!0,get(){return l.rawInnerHTMLDesc.get.call(this)},set(n){l.rawInnerHTMLDesc.set.call(this,n);const o=j();Array.from(this.children).forEach(i=>{se(i)&&o&&(i.__MICRO_APP_NAME__=o)})}}),F(e.prototype,"parentNode",{configurable:!0,enumerable:!0,get(){var n,o,i;const s=j();if(s&&this===l.rawDocument.firstElementChild){const c=(i=(o=(n=b.get(s))===null||n===void 0?void 0:n.sandBox)===null||o===void 0?void 0:o.proxyWindow)===null||i===void 0?void 0:i.document;if(c)return c}return l.rawParentNodeDesc.get.call(this)}})}function _e(t){const e=j();return e&&(t.__MICRO_APP_NAME__=e),t}function ko(){const t=l.rawDocument,e=l.rawRootDocument;function r(i){return pn(i)?t:i}e.prototype.createElement=function(s,a){const c=l.rawCreateElement.call(r(this),s,a);return _e(c)},e.prototype.createElementNS=function(s,a,c){const g=l.rawCreateElementNS.call(r(this),s,a,c);return _e(g)},e.prototype.createDocumentFragment=function(){const s=l.rawCreateDocumentFragment.call(r(this));return _e(s)},e.prototype.createComment=function(s){const a=l.rawCreateComment.call(r(this),s);return _e(a)};function n(i){var s,a;const c=r(this),g=j();return!g||!i||ge(i)||t!==c?l.rawQuerySelector.call(c,i):(a=(s=b.get(g))===null||s===void 0?void 0:s.querySelector(i))!==null&&a!==void 0?a:null}function o(i){var s,a;const c=r(this),g=j();return!g||!i||ge(i)||t!==c?l.rawQuerySelectorAll.call(c,i):(a=(s=b.get(g))===null||s===void 0?void 0:s.querySelectorAll(i))!==null&&a!==void 0?a:[]}e.prototype.querySelector=n,e.prototype.querySelectorAll=o,e.prototype.getElementById=function(s){const a=r(this);if(!j()||ie(s))return l.rawGetElementById.call(a,s);try{return n.call(a,`#${s}`)}catch{return l.rawGetElementById.call(a,s)}},e.prototype.getElementsByClassName=function(s){const a=r(this);if(!j()||ie(s))return l.rawGetElementsByClassName.call(a,s);try{return o.call(a,`.${s}`)}catch{return l.rawGetElementsByClassName.call(a,s)}},e.prototype.getElementsByTagName=function(s){var a;const c=r(this),g=j();if(!g||ge(s)||ie(s)||!(!((a=b.get(g))===null||a===void 0)&&a.inline)&&/^script$/i.test(s))return l.rawGetElementsByTagName.call(c,s);try{return o.call(c,s)}catch{return l.rawGetElementsByTagName.call(c,s)}},e.prototype.getElementsByName=function(s){const a=r(this);if(!j()||ie(s))return l.rawGetElementsByName.call(a,s);try{return o.call(a,`[name=${s}]`)}catch{return l.rawGetElementsByName.call(a,s)}}}function ei(){const t=l.rawRootDocument;t.prototype.createElement=l.rawCreateElement,t.prototype.createElementNS=l.rawCreateElementNS,t.prototype.createDocumentFragment=l.rawCreateDocumentFragment,t.prototype.querySelector=l.rawQuerySelector,t.prototype.querySelectorAll=l.rawQuerySelectorAll,t.prototype.getElementById=l.rawGetElementById,t.prototype.getElementsByClassName=l.rawGetElementsByClassName,t.prototype.getElementsByTagName=l.rawGetElementsByTagName,t.prototype.getElementsByName=l.rawGetElementsByName}function jr(){U(),ei();const t=l.rawRootElement,e=l.rawRootNode;t.prototype.appendChild=l.rawAppendChild,t.prototype.insertBefore=l.rawInsertBefore,t.prototype.replaceChild=l.rawReplaceChild,t.prototype.removeChild=l.rawRemoveChild,t.prototype.append=l.rawAppend,t.prototype.prepend=l.rawPrepend,t.prototype.cloneNode=l.rawCloneNode,t.prototype.querySelector=l.rawElementQuerySelector,t.prototype.querySelectorAll=l.rawElementQuerySelectorAll,t.prototype.setAttribute=l.rawSetAttribute,F(t.prototype,"innerHTML",l.rawInnerHTMLDesc),F(e.prototype,"parentNode",l.rawParentNodeDesc)}let jt=!1;function ti(){if(!jt){jt=!0;const t=K("style");l.rawSetAttribute.call(t,"type","text/css"),t.textContent=`
${R.tagName}, micro-app-body { display: block; } 
micro-app-head { display: none; }`,l.rawDocument.head.appendChild(t)}}const l={activeSandbox:0};function ri(){if(ut){const t=window.rawWindow||Function("return window")(),e=window.rawDocument||Function("return document")(),r=t.Document||Function("return Document")(),n=t.Element,o=t.Node,i=t.EventTarget,s=n.prototype.setAttribute,a=n.prototype.appendChild,c=n.prototype.insertBefore,g=n.prototype.replaceChild,m=n.prototype.removeChild,A=n.prototype.append,P=n.prototype.prepend,M=n.prototype.cloneNode,O=n.prototype.querySelector,v=n.prototype.querySelectorAll,S=n.prototype.insertAdjacentElement,_=Object.getOwnPropertyDescriptor(n.prototype,"innerHTML"),p=Object.getOwnPropertyDescriptor(o.prototype,"parentNode"),d=r.prototype.createElement,f=r.prototype.createElementNS,w=r.prototype.createTextNode,u=r.prototype.createDocumentFragment,h=r.prototype.createComment,E=r.prototype.querySelector,I=r.prototype.querySelectorAll,Pe=r.prototype.getElementById,Kr=r.prototype.getElementsByClassName,qr=r.prototype.getElementsByTagName,Qr=r.prototype.getElementsByName,Vr=new Proxy(Image,{construct(nn,on){const yt=new nn(...on),Mt=j();return Mt&&(yt.__MICRO_APP_NAME__=Mt),yt}}),Xr=t.setInterval,zr=t.setTimeout,Yr=t.clearInterval,Jr=t.clearTimeout,Zr=t.history.pushState,kr=t.history.replaceState,en=i.prototype.addEventListener,tn=i.prototype.removeEventListener,rn=i.prototype.dispatchEvent;window.__MICRO_APP_BASE_APPLICATION__=!0,X(l,{supportModuleScript:_n(),rawWindow:t,rawDocument:e,rawRootDocument:r,rawRootElement:n,rawRootNode:o,rawSetAttribute:s,rawAppendChild:a,rawInsertBefore:c,rawReplaceChild:g,rawRemoveChild:m,rawAppend:A,rawPrepend:P,rawCloneNode:M,rawElementQuerySelector:O,rawElementQuerySelectorAll:v,rawInsertAdjacentElement:S,rawInnerHTMLDesc:_,rawParentNodeDesc:p,rawCreateElement:d,rawCreateElementNS:f,rawCreateDocumentFragment:u,rawCreateTextNode:w,rawCreateComment:h,rawQuerySelector:E,rawQuerySelectorAll:I,rawGetElementById:Pe,rawGetElementsByClassName:Kr,rawGetElementsByTagName:qr,rawGetElementsByName:Qr,ImageProxy:Vr,rawSetInterval:Xr,rawSetTimeout:zr,rawClearInterval:Yr,rawClearTimeout:Jr,rawPushState:Zr,rawReplaceState:kr,rawAddEventListener:en,rawRemoveEventListener:tn,rawDispatchEvent:rn}),ti()}}function ni(t){class e extends vn(){constructor(){super(...arguments),this.isWaiting=!1,this.cacheData=null,this.connectedCount=0,this.connectStateMap=new Map,this.appName="",this.appUrl="",this.ssrUrl="",this.version=sn,this.handleAttributeUpdate=()=>{this.isWaiting=!1;const n=W(this.getAttribute("name")),o=st(this.getAttribute("url"),this.appName);if(this.legalAttribute("name",n)&&this.legalAttribute("url",o)){const i=b.get(n);if(n!==this.appName&&i&&!i.isUnmounted()&&!i.isHidden()&&!i.isPrefetch)return this.setAttribute("name",this.appName),D(`app name conflict, an app named ${n} is running`);(n!==this.appName||o!==this.appUrl)&&(n===this.appName?this.unmount(!0,()=>{this.actionsForAttributeChange(n,o,i)}):this.getKeepAliveModeResult()?(this.handleHiddenKeepAliveApp(),this.actionsForAttributeChange(n,o,i)):this.unmount(!1,()=>{this.actionsForAttributeChange(n,o,i)}))}else n!==this.appName&&this.setAttribute("name",this.appName)}}static get observedAttributes(){return["name","url"]}connectedCallback(){const n=++this.connectedCount;this.connectStateMap.set(n,!0);const o=this.appName&&this.appUrl;J(()=>{this.connectStateMap.get(n)&&(ne(this,this.appName,C.CREATED),o&&this.handleConnected())})}disconnectedCallback(){this.connectStateMap.set(this.connectedCount,!1),this.handleDisconnected()}reload(n){return new Promise(o=>{const i=()=>{this.removeEventListener(C.MOUNTED,i),this.removeEventListener(C.AFTERSHOW,i),o(!0)};this.addEventListener(C.MOUNTED,i),this.addEventListener(C.AFTERSHOW,i),this.handleDisconnected(n,()=>{this.handleConnected()})})}handleDisconnected(n=!1,o){const i=b.get(this.appName);i&&!i.isUnmounted()&&!i.isHidden()&&(this.getKeepAliveModeResult()&&!n?this.handleHiddenKeepAliveApp(o):this.unmount(n,o))}attributeChangedCallback(n,o,i){if(this.legalAttribute(n,i)&&this[n===ye.NAME?"appName":"appUrl"]!==i)if(n===ye.URL&&(!this.appUrl||!this.connectStateMap.get(this.connectedCount))){if(i=st(i,this.appName),!i)return D(`Invalid attribute url ${i}`,this.appName);this.appUrl=i,this.handleInitialNameAndUrl()}else if(n===ye.NAME&&(!this.appName||!this.connectStateMap.get(this.connectedCount))){const s=W(i);if(!s)return D(`Invalid attribute name ${i}`,this.appName);this.cacheData&&(R.setData(s,this.cacheData),this.cacheData=null),this.appName=s,s!==i&&this.setAttribute("name",this.appName),this.handleInitialNameAndUrl()}else this.isWaiting||(this.isWaiting=!0,J(this.handleAttributeUpdate))}handleInitialNameAndUrl(){this.connectStateMap.get(this.connectedCount)&&this.handleConnected()}handleConnected(){if(!(!this.appName||!this.appUrl))if(this.getDisposeResult("shadowDOM")&&!this.shadowRoot&&y(this.attachShadow)&&this.attachShadow({mode:"open"}),this.updateSsrUrl(this.appUrl),b.has(this.appName)){const n=b.get(this.appName),o=n.ssrUrl||n.url,i=this.ssrUrl||this.appUrl;n.isHidden()&&n.url===this.appUrl?this.handleShowKeepAliveApp(n):o===i&&(n.isUnmounted()||n.isPrefetch&&this.sameCoreOptions(n))?this.handleMount(n):n.isPrefetch||n.isUnmounted()?this.handleCreateApp():D(`app name conflict, an app named: ${this.appName} with url: ${o} is running`)}else this.handleCreateApp()}actionsForAttributeChange(n,o,i){var s;this.updateSsrUrl(o),this.appName=n,this.appUrl=o,((s=this.shadowRoot)!==null&&s!==void 0?s:this).innerHTML="",n!==this.getAttribute("name")&&this.setAttribute("name",this.appName),i?i.isHidden()?i.url===this.appUrl?this.handleShowKeepAliveApp(i):D(`app name conflict, an app named ${this.appName} is running`):i.url===this.appUrl&&i.ssrUrl===this.ssrUrl?this.handleMount(i):this.handleCreateApp():this.handleCreateApp()}legalAttribute(n,o){return!L(o)||!o?(D(`unexpected attribute ${n}, please check again`,this.appName),!1):!0}handleCreateApp(){const n=()=>{var i;return new Ur({name:this.appName,url:this.appUrl,container:(i=this.shadowRoot)!==null&&i!==void 0?i:this,scopecss:this.useScopecss(),useSandbox:this.useSandbox(),inline:this.getDisposeResult("inline"),iframe:this.getDisposeResult("iframe"),ssrUrl:this.ssrUrl,routerMode:this.getMemoryRouterMode()})},o=b.get(this.appName);o?o.isPrerender?this.unmount(!0,n):(o.actionsForCompletelyDestroy(),n()):n()}handleMount(n){n.isPrefetch=!1,n.setAppState(B.BEFORE_MOUNT),J(()=>this.mount(n))}mount(n){var o;n.mount({container:(o=this.shadowRoot)!==null&&o!==void 0?o:this,inline:this.getDisposeResult("inline"),routerMode:this.getMemoryRouterMode(),baseroute:this.getBaseRouteCompatible(),defaultPage:this.getDefaultPage(),disablePatchRequest:this.getDisposeResult("disable-patch-request"),fiber:this.getDisposeResult("fiber")})}unmount(n,o){const i=b.get(this.appName);i&&!i.isUnmounted()&&i.unmount({destroy:n||this.getDestroyCompatibleResult(),clearData:this.getDisposeResult("clear-data"),keepRouteState:this.getDisposeResult("keep-router-state"),unmountcb:o})}handleHiddenKeepAliveApp(n){const o=b.get(this.appName);o&&!o.isUnmounted()&&!o.isHidden()&&o.hiddenKeepAliveApp(n)}handleShowKeepAliveApp(n){J(()=>{var o;return n.showKeepAliveApp((o=this.shadowRoot)!==null&&o!==void 0?o:this)})}getDisposeResult(n){return(this.compatibleProperties(n)||!!R.options[n])&&this.compatibleDisableProperties(n)}compatibleProperties(n){return n==="disable-scopecss"?this.hasAttribute("disable-scopecss")||this.hasAttribute("disableScopecss"):n==="disable-sandbox"?this.hasAttribute("disable-sandbox")||this.hasAttribute("disableSandbox"):this.hasAttribute(n)}compatibleDisableProperties(n){return n==="disable-scopecss"?this.getAttribute("disable-scopecss")!=="false"&&this.getAttribute("disableScopecss")!=="false":n==="disable-sandbox"?this.getAttribute("disable-sandbox")!=="false"&&this.getAttribute("disableSandbox")!=="false":this.getAttribute(n)!=="false"}useScopecss(){return!(this.getDisposeResult("disable-scopecss")||this.getDisposeResult("shadowDOM"))}useSandbox(){return!this.getDisposeResult("disable-sandbox")}sameCoreOptions(n){return n.scopecss===this.useScopecss()&&n.useSandbox===this.useSandbox()&&n.iframe===this.getDisposeResult("iframe")}getBaseRouteCompatible(){var n,o;return(o=(n=this.getAttribute("baseroute"))!==null&&n!==void 0?n:this.getAttribute("baseurl"))!==null&&o!==void 0?o:""}getDestroyCompatibleResult(){return this.getDisposeResult("destroy")||this.getDisposeResult("destory")}getKeepAliveModeResult(){return this.getDisposeResult("keep-alive")&&!this.getDestroyCompatibleResult()}updateSsrUrl(n){if(this.getDisposeResult("ssr"))if(this.getDisposeResult("disable-memory-router")||this.getDisposeResult("disableSandbox")){const o=l.rawWindow.location;this.ssrUrl=G(o.pathname+o.search,n)}else{let o=po(this.appName,n);const i=this.getDefaultPage();if(!o&&i){const s=x(i,n);o=s.origin+s.pathname+s.search}this.ssrUrl=o}else this.ssrUrl&&(this.ssrUrl="")}getDefaultPage(){return He.getDefaultPage(this.appName)||this.getAttribute("default-page")||this.getAttribute("defaultPage")||""}getMemoryRouterMode(){return yr(this.getAttribute("router-mode"),this.compatibleProperties("disable-memory-router")&&this.compatibleDisableProperties("disable-memory-router"))}setAttribute(n,o){if(n==="data")if(T(o)){const i={};Object.getOwnPropertyNames(o).forEach(s=>{L(s)&&s.indexOf("__")===0||(i[s]=o[s])}),this.data=i}else o!=="[object Object]"&&le("property data must be an object",this.appName);else l.rawSetAttribute.call(this,n,o)}set data(n){this.appName?R.setData(this.appName,n):this.cacheData=n}get data(){return this.appName?R.getData(this.appName,!0):this.cacheData?this.cacheData:null}get publicPath(){return Xe(this.appUrl)}get baseRoute(){return this.getBaseRouteCompatible()}}l.rawWindow.customElements.define(t,e)}function Gt(t,e){if(!ut)return D("preFetch is only supported in browser environment");Ye(()=>{const r=nt(e)?e:R.options.prefetchDelay;setTimeout(()=>{oi(t)},nt(r)?r:3e3)})}function oi(t){y(t)&&(t=t()),k(t)&&t.reduce((e,r)=>e.then(()=>ii(r)),Promise.resolve())}function ii(t){return zt(e=>{var r,n,o,i,s,a;if(T(t)&&navigator.onLine)if(t.name=W(t.name),t.url=st(t.url,t.name),t.name&&t.url&&!b.has(t.name)){const c=new Ur({name:t.name,url:t.url,isPrefetch:!0,scopecss:!((n=(r=t["disable-scopecss"])!==null&&r!==void 0?r:t.disableScopecss)!==null&&n!==void 0?n:R.options["disable-scopecss"]),useSandbox:!((i=(o=t["disable-sandbox"])!==null&&o!==void 0?o:t.disableSandbox)!==null&&i!==void 0?i:R.options["disable-sandbox"]),inline:(s=t.inline)!==null&&s!==void 0?s:R.options.inline,iframe:(a=t.iframe)!==null&&a!==void 0?a:R.options.iframe,prefetchLevel:t.level&&Tt.includes(t.level)?t.level:R.options.prefetchLevel&&Tt.includes(R.options.prefetchLevel)?R.options.prefetchLevel:2}),g=c.onLoad,m=c.onLoadError;c.onLoad=A=>{c.isPrerender&&X(A,{defaultPage:t["default-page"],routerMode:yr(t["router-mode"]),baseroute:t.baseroute,disablePatchRequest:t["disable-patch-request"]}),e(),g.call(c,A)},c.onLoadError=(...A)=>{e(),m.call(c,...A)}}else e();else e()})}function si(t){T(t)&&Ye(()=>{Kt(t.js,"js",q.script),Kt(t.css,"css",q.link)})}function Kt(t,e,r){if(k(t)){const n=t.filter(i=>L(i)&&i.includes(`.${e}`)&&!r.hasInfo(i)),o=n.map(i=>pe(i));ze(o,i=>{const s=n[i.index];e==="js"?r.hasInfo(s)||r.setInfo(s,{code:i.data,isExternal:!1,appSpace:{}}):r.hasInfo(s)||r.setInfo(s,{code:i.data,appSpace:{}})},i=>{D(i)})}}function we({excludeHiddenApp:t=!1,excludePreRender:e=!1}={}){const r=[];return b.forEach((n,o)=>{!n.isUnmounted()&&(!n.isPrefetch||n.isPrerender&&!e)&&(!t||!n.isHidden())&&r.push(o)}),r}function ai(){return Array.from(b.keys())}function Gr(t,e){const r=b.get(W(t));return new Promise(n=>{if(r)if(r.isUnmounted()||r.isPrefetch)r.isPrerender?r.unmount({destroy:!!(e!=null&&e.destroy),clearData:!!(e!=null&&e.clearData),keepRouteState:!1,unmountcb:n.bind(null,!0)}):(e!=null&&e.destroy&&r.actionsForCompletelyDestroy(),n(!0));else if(r.isHidden())e!=null&&e.destroy?r.unmount({destroy:!0,clearData:!0,keepRouteState:!0,unmountcb:n.bind(null,!0)}):e!=null&&e.clearAliveState?r.unmount({destroy:!1,clearData:!!e.clearData,keepRouteState:!0,unmountcb:n.bind(null,!0)}):n(!0);else{const o=te(r.container),i=()=>{o.removeEventListener(C.UNMOUNT,i),o.removeEventListener(C.AFTERHIDDEN,s),n(!0)},s=()=>{o.removeEventListener(C.UNMOUNT,i),o.removeEventListener(C.AFTERHIDDEN,s),n(!0)};if(o.addEventListener(C.UNMOUNT,i),o.addEventListener(C.AFTERHIDDEN,s),e!=null&&e.destroy){let a,c;o.hasAttribute("destroy")&&(a=o.getAttribute("destroy")),o.hasAttribute("destory")&&(c=o.getAttribute("destory")),o.setAttribute("destroy","true"),o.parentNode.removeChild(o),o.removeAttribute("destroy"),L(a)&&o.setAttribute("destroy",a),L(c)&&o.setAttribute("destory",c)}else if(e!=null&&e.clearAliveState&&o.hasAttribute("keep-alive")){const a=o.getAttribute("keep-alive");o.removeAttribute("keep-alive");let c=null;e.clearData&&(c=o.getAttribute("clear-data"),o.setAttribute("clear-data","true")),o.parentNode.removeChild(o),o.setAttribute("keep-alive",a),L(c)&&o.setAttribute("clear-data",c)}else{let a=null;e!=null&&e.clearData&&(a=o.getAttribute("clear-data"),o.setAttribute("clear-data","true")),o.parentNode.removeChild(o),L(a)&&o.setAttribute("clear-data",a)}}else le(`app ${t} does not exist`),n(!1)})}function ci(t){return Array.from(b.keys()).reduce((e,r)=>e.then(()=>Gr(r,t)),Promise.resolve(!0))}function li(t,e){return new Promise(r=>{const n=b.get(W(t));if(n){const o=n.container&&te(n.container);o?r(o.reload(e)):(le(`app ${t} is not rendered, cannot use reload`),r(!1))}else le(`app ${t} does not exist`),r(!1)})}function ui(t){return new Promise(e=>{if(!T(t))return D("renderApp options must be an object");const r=se(t.container)?t.container:L(t.container)?document.querySelector(t.container):null;if(!se(r))return D("Target container is not a DOM element.");const n=K(R.tagName);for(const a in t)if(a==="onDataChange")y(t[a])&&n.addEventListener("datachange",t[a]);else if(a==="lifeCycles"){const c=t[a];if(T(c))for(const g in c)g.toUpperCase()in C&&y(c[g])&&n.addEventListener(g.toLowerCase(),c[g])}else a!=="container"&&n.setAttribute(a,t[a]);const o=()=>{s(),e(!0)},i=()=>{s(),e(!1)},s=()=>{n.removeEventListener(C.MOUNTED,o),n.removeEventListener(C.ERROR,i)};n.addEventListener(C.MOUNTED,o),n.addEventListener(C.ERROR,i),r.appendChild(n)})}function hi(t){const e=b.get(W(t));if(e)return e.getLifeCycleState();le(`app ${t} does not exist`)}class di extends Zn{constructor(){super(...arguments),this.tagName="micro-app",this.hasInit=!1,this.options={},this.router=He,this.preFetch=Gt,this.unmountApp=Gr,this.unmountAllApps=ci,this.getActiveApps=we,this.getAllApps=ai,this.reload=li,this.renderApp=ui,this.getAppStatus=hi}start(e){var r,n;if(!ut||!window.customElements)return D("micro-app is not supported in this environment");if(this.hasInit)return D("microApp.start executed repeatedly");if(this.hasInit=!0,e!=null&&e.tagName)if(/^micro-app(-\S+)?/.test(e.tagName))this.tagName=e.tagName;else return D(`${e.tagName} is invalid tagName`);if(ri(),l.rawWindow.customElements.get(this.tagName))return le(`element ${this.tagName} is already defined`);if(T(e)&&(this.options=e,e["disable-scopecss"]=(r=e["disable-scopecss"])!==null&&r!==void 0?r:e.disableScopecss,e["disable-sandbox"]=(n=e["disable-sandbox"])!==null&&n!==void 0?n:e.disableSandbox,e.preFetchApps&&Gt(e.preFetchApps),e.globalAssets&&si(e.globalAssets),T(e.plugins))){const o=e.plugins.modules;if(T(o))for(const i in o){const s=W(i);s&&i!==s&&(o[s]=o[i],delete o[i])}}ni(this.tagName)}}const R=new di;export{R as m};
