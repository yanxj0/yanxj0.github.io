function F(e){return function(){return e}}function V(e){return e[0]}function W(e){return e[1]}function H(){this._=null}function _(e){e.U=e.C=e.L=e.R=e.P=e.N=null}H.prototype={constructor:H,insert:function(e,t){var i,l,r;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;i=e}else this._?(e=T(this._),t.P=null,t.N=e,e.P=e.L=t,i=e):(t.P=t.N=null,this._=t,i=null);for(t.L=t.R=null,t.U=i,t.C=!0,e=t;i&&i.C;)l=i.U,i===l.L?(r=l.R,r&&r.C?(i.C=r.C=!1,l.C=!0,e=l):(e===i.R&&(y(this,i),e=i,i=e.U),i.C=!1,l.C=!0,B(this,l))):(r=l.L,r&&r.C?(i.C=r.C=!1,l.C=!0,e=l):(e===i.L&&(B(this,i),e=i,i=e.U),i.C=!1,l.C=!0,y(this,l))),i=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t=e.U,i,l=e.L,r=e.R,n,s;if(l?r?n=T(r):n=l:n=r,t?t.L===e?t.L=n:t.R=n:this._=n,l&&r?(s=n.C,n.C=e.C,n.L=l,l.U=n,n!==r?(t=n.U,n.U=e.U,e=n.R,t.L=e,n.R=r,r.U=n):(n.U=t,t=n,e=n.R)):(s=e.C,e=n),e&&(e.U=t),!s){if(e&&e.C){e.C=!1;return}do{if(e===this._)break;if(e===t.L){if(i=t.R,i.C&&(i.C=!1,t.C=!0,y(this,t),i=t.R),i.L&&i.L.C||i.R&&i.R.C){(!i.R||!i.R.C)&&(i.L.C=!1,i.C=!0,B(this,i),i=t.R),i.C=t.C,t.C=i.R.C=!1,y(this,t),e=this._;break}}else if(i=t.L,i.C&&(i.C=!1,t.C=!0,B(this,t),i=t.L),i.L&&i.L.C||i.R&&i.R.C){(!i.L||!i.L.C)&&(i.R.C=!1,i.C=!0,y(this,i),i=t.L),i.C=t.C,t.C=i.L.C=!1,B(this,t),e=this._;break}i.C=!0,e=t,t=t.U}while(!e.C);e&&(e.C=!1)}}};function y(e,t){var i=t,l=t.R,r=i.U;r?r.L===i?r.L=l:r.R=l:e._=l,l.U=r,i.U=l,i.R=l.L,i.R&&(i.R.U=i),l.L=i}function B(e,t){var i=t,l=t.L,r=i.U;r?r.L===i?r.L=l:r.R=l:e._=l,l.U=r,i.U=l,i.L=l.R,i.L&&(i.L.U=i),l.R=i}function T(e){for(;e.L;)e=e.L;return e}function x(e,t,i,l){var r=[null,null],n=w.push(r)-1;return r.left=e,r.right=t,i&&S(r,e,t,i),l&&S(r,t,e,l),U[e.index].halfedges.push(n),U[t.index].halfedges.push(n),r}function m(e,t,i){var l=[t,i];return l.left=e,l}function S(e,t,i,l){!e[0]&&!e[1]?(e[0]=l,e.left=t,e.right=i):e.left===i?e[1]=l:e[0]=l}function Z(e,t,i,l,r){var n=e[0],s=e[1],f=n[0],c=n[1],a=s[0],g=s[1],h=0,o=1,v=a-f,C=g-c,u;if(u=t-f,!(!v&&u>0)){if(u/=v,v<0){if(u<h)return;u<o&&(o=u)}else if(v>0){if(u>o)return;u>h&&(h=u)}if(u=l-f,!(!v&&u<0)){if(u/=v,v<0){if(u>o)return;u>h&&(h=u)}else if(v>0){if(u<h)return;u<o&&(o=u)}if(u=i-c,!(!C&&u>0)){if(u/=C,C<0){if(u<h)return;u<o&&(o=u)}else if(C>0){if(u>o)return;u>h&&(h=u)}if(u=r-c,!(!C&&u<0)){if(u/=C,C<0){if(u>o)return;u>h&&(h=u)}else if(C>0){if(u<h)return;u<o&&(o=u)}return!(h>0)&&!(o<1)||(h>0&&(e[0]=[f+h*v,c+h*C]),o<1&&(e[1]=[f+o*v,c+o*C])),!0}}}}}function j(e,t,i,l,r){var n=e[1];if(n)return!0;var s=e[0],f=e.left,c=e.right,a=f[0],g=f[1],h=c[0],o=c[1],v=(a+h)/2,C=(g+o)/2,u,p;if(o===g){if(v<t||v>=l)return;if(a>h){if(!s)s=[v,i];else if(s[1]>=r)return;n=[v,r]}else{if(!s)s=[v,r];else if(s[1]<i)return;n=[v,i]}}else if(u=(a-h)/(o-g),p=C-u*v,u<-1||u>1)if(a>h){if(!s)s=[(i-p)/u,i];else if(s[1]>=r)return;n=[(r-p)/u,r]}else{if(!s)s=[(r-p)/u,r];else if(s[1]<i)return;n=[(i-p)/u,i]}else if(g<o){if(!s)s=[t,u*t+p];else if(s[0]>=l)return;n=[l,u*l+p]}else{if(!s)s=[l,u*l+p];else if(s[0]<t)return;n=[t,u*t+p]}return e[0]=s,e[1]=n,!0}function ee(e,t,i,l){for(var r=w.length,n;r--;)(!j(n=w[r],e,t,i,l)||!Z(n,e,t,i,l)||!(Math.abs(n[0][0]-n[1][0])>R||Math.abs(n[0][1]-n[1][1])>R))&&delete w[r]}function ie(e){return U[e.index]={site:e,halfedges:[]}}function te(e,t){var i=e.site,l=t.left,r=t.right;return i===r&&(r=l,l=i),r?Math.atan2(r[1]-l[1],r[0]-l[0]):(i===l?(l=t[1],r=t[0]):(l=t[0],r=t[1]),Math.atan2(l[0]-r[0],r[1]-l[1]))}function J(e,t){return t[+(t.left!==e.site)]}function re(e,t){return t[+(t.left===e.site)]}function le(){for(var e=0,t=U.length,i,l,r,n;e<t;++e)if((i=U[e])&&(n=(l=i.halfedges).length)){var s=new Array(n),f=new Array(n);for(r=0;r<n;++r)s[r]=r,f[r]=te(i,w[l[r]]);for(s.sort(function(c,a){return f[a]-f[c]}),r=0;r<n;++r)f[r]=l[s[r]];for(r=0;r<n;++r)l[r]=f[r]}}function ne(e,t,i,l){var r=U.length,n,s,f,c,a,g,h,o,v,C,u,p,L=!0;for(n=0;n<r;++n)if(s=U[n]){for(f=s.site,a=s.halfedges,c=a.length;c--;)w[a[c]]||a.splice(c,1);for(c=0,g=a.length;c<g;)C=re(s,w[a[c]]),u=C[0],p=C[1],h=J(s,w[a[++c%g]]),o=h[0],v=h[1],(Math.abs(u-o)>R||Math.abs(p-v)>R)&&(a.splice(c,0,w.push(m(f,C,Math.abs(u-e)<R&&l-p>R?[e,Math.abs(o-e)<R?v:l]:Math.abs(p-l)<R&&i-u>R?[Math.abs(v-l)<R?o:i,l]:Math.abs(u-i)<R&&p-t>R?[i,Math.abs(o-i)<R?v:t]:Math.abs(p-t)<R&&u-e>R?[Math.abs(v-t)<R?o:e,t]:null))-1),++g);g&&(L=!1)}if(L){var M,b,P,X=1/0;for(n=0,L=null;n<r;++n)(s=U[n])&&(f=s.site,M=f[0]-e,b=f[1]-t,P=M*M+b*b,P<X&&(X=P,L=s));if(L){var Y=[e,t],d=[e,l],z=[i,l],D=[i,t];L.halfedges.push(w.push(m(f=L.site,Y,d))-1,w.push(m(f,d,z))-1,w.push(m(f,z,D))-1,w.push(m(f,D,Y))-1)}}for(n=0;n<r;++n)(s=U[n])&&(s.halfedges.length||delete U[n])}var K=[],$;function fe(){_(this),this.x=this.y=this.arc=this.site=this.cy=null}function N(e){var t=e.P,i=e.N;if(!(!t||!i)){var l=t.site,r=e.site,n=i.site;if(l!==n){var s=r[0],f=r[1],c=l[0]-s,a=l[1]-f,g=n[0]-s,h=n[1]-f,o=2*(c*h-a*g);if(!(o>=-he)){var v=c*c+a*a,C=g*g+h*h,u=(h*v-a*C)/o,p=(c*C-g*v)/o,L=K.pop()||new fe;L.arc=e,L.site=r,L.x=u+s,L.y=(L.cy=p+f)+Math.sqrt(u*u+p*p),e.circle=L;for(var M=null,b=E._;b;)if(L.y<b.y||L.y===b.y&&L.x<=b.x)if(b.L)b=b.L;else{M=b.P;break}else if(b.R)b=b.R;else{M=b;break}E.insert(M,L),M||($=L)}}}}function k(e){var t=e.circle;t&&(t.P||($=t.N),E.remove(t),K.push(t),_(t),e.circle=null)}var O=[];function se(){_(this),this.edge=this.site=this.circle=null}function G(e){var t=O.pop()||new se;return t.site=e,t}function q(e){k(e),A.remove(e),O.push(e),_(e)}function ue(e){var t=e.circle,i=t.x,l=t.cy,r=[i,l],n=e.P,s=e.N,f=[e];q(e);for(var c=n;c.circle&&Math.abs(i-c.circle.x)<R&&Math.abs(l-c.circle.cy)<R;)n=c.P,f.unshift(c),q(c),c=n;f.unshift(c),k(c);for(var a=s;a.circle&&Math.abs(i-a.circle.x)<R&&Math.abs(l-a.circle.cy)<R;)s=a.N,f.push(a),q(a),a=s;f.push(a),k(a);var g=f.length,h;for(h=1;h<g;++h)a=f[h],c=f[h-1],S(a.edge,c.site,a.site,r);c=f[0],a=f[g-1],a.edge=x(c.site,a.site,null,r),N(c),N(a)}function ae(e){for(var t=e[0],i=e[1],l,r,n,s,f=A._;f;)if(n=Q(f,i)-t,n>R)f=f.L;else if(s=t-ce(f,i),s>R){if(!f.R){l=f;break}f=f.R}else{n>-R?(l=f.P,r=f):s>-R?(l=f,r=f.N):l=r=f;break}ie(e);var c=G(e);if(A.insert(l,c),!(!l&&!r)){if(l===r){k(l),r=G(l.site),A.insert(c,r),c.edge=r.edge=x(l.site,c.site),N(l),N(r);return}if(!r){c.edge=x(l.site,c.site);return}k(l),k(r);var a=l.site,g=a[0],h=a[1],o=e[0]-g,v=e[1]-h,C=r.site,u=C[0]-g,p=C[1]-h,L=2*(o*p-v*u),M=o*o+v*v,b=u*u+p*p,P=[(p*M-v*b)/L+g,(o*b-u*M)/L+h];S(r.edge,a,C,P),c.edge=x(a,e,null,P),r.edge=x(e,C,null,P),N(l),N(r)}}function Q(e,t){var i=e.site,l=i[0],r=i[1],n=r-t;if(!n)return l;var s=e.P;if(!s)return-1/0;i=s.site;var f=i[0],c=i[1],a=c-t;if(!a)return f;var g=f-l,h=1/n-1/a,o=g/a;return h?(-o+Math.sqrt(o*o-2*h*(g*g/(-2*a)-c+a/2+r-n/2)))/h+l:(l+f)/2}function ce(e,t){var i=e.N;if(i)return Q(i,t);var l=e.site;return l[1]===t?l[0]:1/0}var R=1e-6,he=1e-12,A,U,E,w;function oe(e,t,i){return(e[0]-i[0])*(t[1]-e[1])-(e[0]-t[0])*(i[1]-e[1])}function ve(e,t){return t[1]-e[1]||t[0]-e[0]}function I(e,t){var i=e.sort(ve).pop(),l,r,n;for(w=[],U=new Array(e.length),A=new H,E=new H;;)if(n=$,i&&(!n||i[1]<n.y||i[1]===n.y&&i[0]<n.x))(i[0]!==l||i[1]!==r)&&(ae(i),l=i[0],r=i[1]),i=e.pop();else if(n)ue(n.arc);else break;if(le(),t){var s=+t[0][0],f=+t[0][1],c=+t[1][0],a=+t[1][1];ee(s,f,c,a),ne(s,f,c,a)}this.edges=w,this.cells=U,A=E=w=U=null}I.prototype={constructor:I,polygons:function(){var e=this.edges;return this.cells.map(function(t){var i=t.halfedges.map(function(l){return J(t,e[l])});return i.data=t.site.data,i})},triangles:function(){var e=[],t=this.edges;return this.cells.forEach(function(i,l){if(f=(n=i.halfedges).length)for(var r=i.site,n,s=-1,f,c,a=t[n[f-1]],g=a.left===r?a.right:a.left;++s<f;)c=g,a=t[n[s]],g=a.left===r?a.right:a.left,c&&g&&l<c.index&&l<g.index&&oe(r,c,g)<0&&e.push([r.data,c.data,g.data])}),e},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(e,t,i){for(var l=this,r,n=l._found||0,s=l.cells.length,f;!(f=l.cells[n]);)if(++n>=s)return null;var c=e-f.site[0],a=t-f.site[1],g=c*c+a*a;do f=l.cells[r=n],n=null,f.halfedges.forEach(function(h){var o=l.edges[h],v=o.left;if(!((v===f.site||!v)&&!(v=o.right))){var C=e-v[0],u=t-v[1],p=C*C+u*u;p<g&&(g=p,n=v.index)}});while(n!==null);return l._found=r,i==null||g<=i*i?f.site:null}};function ge(){var e=V,t=W,i=null;function l(r){return new I(r.map(function(n,s){var f=[Math.round(e(n,s,r)/R)*R,Math.round(t(n,s,r)/R)*R];return f.index=s,f.data=n,f}),i)}return l.polygons=function(r){return l(r).polygons()},l.links=function(r){return l(r).links()},l.triangles=function(r){return l(r).triangles()},l.x=function(r){return arguments.length?(e=typeof r=="function"?r:F(+r),l):e},l.y=function(r){return arguments.length?(t=typeof r=="function"?r:F(+r),l):t},l.extent=function(r){return arguments.length?(i=r==null?null:[[+r[0][0],+r[0][1]],[+r[1][0],+r[1][1]]],l):i&&[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},l.size=function(r){return arguments.length?(i=r==null?null:[[0,0],[+r[0],+r[1]]],l):i&&[i[1][0]-i[0][0],i[1][1]-i[0][1]]},l}export{ge as v};
