(function(){"use strict";self.importScripts("/statics/data/RollHeatmapData.js");let e=null,f=null,r=null,g=null,u=1920,h=null,d=!1,w=0;self.onmessage=function(t){let{action:l,rect:a,zoom:n,offScreen:o}=t.data;switch(l){case"init":e=a,u=a.width,f=o,S(),x();break;case"datazoom":h=n,d=!0;break}};let m=null;const x=()=>{m=setInterval(()=>{const t=source[w]||[];if(t!=null&&t.length){const l=t.map(F=>F/10),a=y(l,w++);self.postMessage({status:"success",data:{yData:l}});const{x:n,y:o,width:s,height:c}=e,i=f.getContext("2d");i.clearRect(n,o,s,c),i.drawImage(a,n,o,s,c)}else clearInterval(m)},500)},C=(t,l)=>{r=new OffscreenCanvas(t,l)},y=(t,l)=>{let a=[];h?a=t.slice(...h):a=t;let n=p(a.length)||1;const o=Math.ceil(a.length/n);r||C(o,e.height);let s=r.getContext("2d");l!==0&&(s.clearRect(0,0,r.width,r.height),d?(d=!1,r.width=o):s.drawImage(g,0,1,r.width,r.height));let c=0;for(;c<o;){const i=c*n,F=Math.max(...a.slice(i,i+n)),I=v(F);s.fillStyle=I,s.fillRect(c++,0,1,1)}return g=r.transferToImageBitmap()},p=t=>Math.floor(t/u),R=(t,l,a)=>"#"+(1<<24|t<<16|l<<8|a).toString(16).slice(1),S=()=>{const t=f.getContext("2d",{willReadFrequently:!0});let l=t.createLinearGradient(0,e.y,0,e.height+e.y);["#000083","#0010FF","#009FFF","#00FFFF","#87FF78","#FFF700","#FF4C00","#800000"].reverse().forEach((o,s)=>{l.addColorStop(0+s*(1/8),o)}),t.fillStyle=l,t.fillRect(e.x+5+e.width,e.y,15,e.height);const a=[100,80,60,40,20,0,-20,-40],n=a.length-1;a.forEach((o,s)=>{t.fillStyle="#fff",t.fillText(o,e.x+10+e.width+20,e.y+e.height*(s/n)+5),t.fillRect(e.x+20+e.width,e.y+e.height*(s/n)+(s===n?-1:1),5,1)})},v=(()=>{let l=new OffscreenCanvas(140,1).getContext("2d",{willReadFrequently:!0}),a=l.createLinearGradient(0,0,140,0);return["#000083","#0010FF","#009FFF","#00FFFF","#87FF78","#FFF700","#FF4C00","#800000"].forEach((n,o)=>{a.addColorStop(0+o*(1/8),n)}),l.fillStyle=a,l.fillRect(0,0,120,1),n=>R(...l.getImageData(n+40,0,1,1).data)})()})();
