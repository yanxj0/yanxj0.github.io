(function(){"use strict";self.importScripts("/statics/data/RollHeatmapData.js");let e=null,f=null,r=null,d=null,m=1920,F=null,g=!1,u=0;self.onmessage=function(t){let{action:a,rect:l,zoom:n,offScreen:s}=t.data;switch(a){case"init":e=l,m=l.width,f=s,S(),C();break;case"datazoom":F=n,g=!0;break;case"close":I();break}};let w=null;const C=()=>{w=setInterval(()=>{const t=source[u]||[];if(t!=null&&t.length){const a=[],l=t.map((x,b)=>(a.push(b),x/10)),n=p(l,u++);self.postMessage({status:"success",data:{yData:l,xData:u===1?a:null}});const{x:s,y:o,width:c,height:i}=e,h=f.getContext("2d");h.clearRect(s,o,c,i),h.drawImage(n,s,o,c,i)}else clearInterval(w)},500)},y=(t,a)=>{r=new OffscreenCanvas(t,a)},p=(t,a)=>{let l=[];F?l=t.slice(...F):l=t;let n=v(l.length)||1;const s=Math.ceil(l.length/n);r||y(s,e.height);let o=r.getContext("2d");a!==0&&(o.clearRect(0,0,r.width,r.height),g?(g=!1,r.width=s):o.drawImage(d,0,1,r.width,r.height));let c=0;for(;c<s;){const i=c*n,h=Math.max(...l.slice(i,i+n)),x=D(h);o.fillStyle=x,o.fillRect(c++,0,1,1)}return d=r.transferToImageBitmap()},v=t=>Math.floor(t/m),R=(t,a,l)=>"#"+(1<<24|t<<16|a<<8|l).toString(16).slice(1),S=()=>{const t=f.getContext("2d",{willReadFrequently:!0});let a=t.createLinearGradient(0,e.y,0,e.height+e.y);["#000083","#0010FF","#009FFF","#00FFFF","#87FF78","#FFF700","#FF4C00","#800000"].reverse().forEach((s,o)=>{a.addColorStop(0+o*(1/8),s)}),t.fillStyle=a,t.fillRect(e.x+5+e.width,e.y,15,e.height);const l=[100,80,60,40,20,0,-20,-40],n=l.length-1;l.forEach((s,o)=>{t.fillStyle="#fff",t.fillText(s,e.x+10+e.width+20,e.y+e.height*(o/n)+5),t.fillRect(e.x+20+e.width,e.y+e.height*(o/n)+(o===n?-1:1),5,1)})},D=(()=>{let a=new OffscreenCanvas(140,1).getContext("2d",{willReadFrequently:!0}),l=a.createLinearGradient(0,0,140,0);return["#000083","#0010FF","#009FFF","#00FFFF","#87FF78","#FFF700","#FF4C00","#800000"].forEach((n,s)=>{l.addColorStop(0+s*(1/8),n)}),a.fillStyle=l,a.fillRect(0,0,120,1),n=>R(...a.getImageData(n+40,0,1,1).data)})(),I=()=>{d=null,r=null,e=null,f=null,clearInterval(w),self.close()}})();
